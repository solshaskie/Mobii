"use strict";exports.id=168,exports.ids=[168],exports.modules={9168:(e,t,s)=>{s.d(t,{y:()=>b});var a=s(5402),i=s(6964),o=s(9472),r=s(1931),n=s(3750),l=s(9630),c=s(2037),d=s(3432),u=s(76),h=s(822),m=s(7427),p=s(3968),g=s(876);class x{getInitialized(){return this.isInitialized}async initialize(){try{return console.log("Initializing MediaPipe Pose..."),this.pose=new m.Pose({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${e}`}),this.pose.setOptions({modelComplexity:1,smoothLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),this.pose.onResults(e=>{this.onPoseResults(e)}),this.isInitialized=!0,console.log("MediaPipe Pose initialized successfully"),!0}catch(e){return console.error("Failed to initialize MediaPipe Pose:",e),!1}}onPoseResults(e){if(!e.poseLandmarks)return;let t=e.poseLandmarks;this.poseHistory.push(t),this.poseHistory.length>30&&this.poseHistory.shift();let s=this.analyzeForm(t);this.emitResults(e,s)}analyzeForm(e){let t={posture:"good",feedback:"",confidence:0,repDetected:!1,repCount:this.repCount},s=e.filter(e=>e.visibility&&e.visibility>.5);t.confidence=s.length/e.length;let a=this.analyzePosture(e);a>.8?(t.posture="good",t.feedback="Excellent posture! Keep it up!"):a>.6?(t.posture="needs_improvement",t.feedback="Try to straighten your back and align your shoulders."):(t.posture="poor",t.feedback="Please correct your posture. Stand tall with shoulders back.");let i=this.detectRepetition(e);return i&&(this.repCount++,t.repDetected=!0,t.repCount=this.repCount),t}analyzePosture(e){if(e.length<33)return 0;let t=e[0],s=e[11],a=e[12],i=e[23],o=e[24],r=0,n=0;if(s&&a){let e=Math.abs(s.y-a.y);r+=Math.max(0,1-10*e),n++}if(s&&a&&i&&o){let e=(s.y+a.y)/2,t=(i.y+o.y)/2;r+=Math.max(0,1-5*Math.abs(e-t)),n++}if(t&&s&&a){let e=(s.y+a.y)/2,i=Math.abs(t.y-e);r+=Math.max(0,1-3*i),n++}return n>0?r/n:0}detectRepetition(e){if(this.poseHistory.length<10)return!1;let t=e[15],s=e[16],a=e[13],i=e[14];if(!t||!s||!a||!i)return!1;let o=this.calculateAngle(t,a,e[11]),r=this.calculateAngle(s,i,e[12]),n=`${o>90?"up":"down"}_${r>90?"up":"down"}`;if(this.lastPoseState&&this.lastPoseState!==n){let e=Date.now()-(this.lastRepTime||0);if(e>1e3)return this.lastRepTime=Date.now(),this.lastPoseState=n,!0}return this.lastPoseState=n,!1}calculateAngle(e,t,s){let a=Math.atan2(s.y-t.y,s.x-t.x)-Math.atan2(e.y-t.y,e.x-t.x);return Math.abs(180*a/Math.PI)}emitResults(e,t){this.onResultsCallback&&this.onResultsCallback(e,t)}setOnResults(e){this.onResultsCallback=e}async startDetection(e,t){if(!this.pose||!this.isInitialized){let e=await this.initialize();if(!e)return!1}try{return console.log("Starting pose detection..."),this.camera=new p.Camera(e,{onFrame:async()=>{this.pose&&await this.pose.send({image:e})},width:640,height:480}),await this.camera.start(),console.log("Pose detection started successfully"),!0}catch(e){return console.error("Failed to start pose detection:",e),!1}}stopDetection(){this.camera&&(this.camera.stop(),this.camera=null),this.repCount=0,this.poseHistory=[],this.lastPoseState="",console.log("Pose detection stopped")}resetRepCount(){this.repCount=0}getRepCount(){return this.repCount}async sendImage(e){this.pose&&this.isInitialized&&await this.pose.send({image:e})}drawPoseLandmarks(e,t){let s=e.getContext("2d");s&&(s.clearRect(0,0,e.width,e.height),t.poseLandmarks&&((0,g.drawConnectors)(s,t.poseLandmarks,m.POSE_CONNECTIONS,{color:"#00FF00",lineWidth:2}),(0,g.drawLandmarks)(s,t.poseLandmarks,{color:"#FF0000",lineWidth:1,radius:3})))}constructor(){this.pose=null,this.camera=null,this.isInitialized=!1,this.repCount=0,this.lastPoseState="",this.lastRepTime=0,this.poseHistory=[],this.onResultsCallback=null}}let y=new x;var f=s(2645);function b({exerciseName:e,instructions:t,onFormFeedback:s,onRepCount:m,onComplete:p,className:g=""}){let[x,b]=(0,i.useState)(!1),[v,j]=(0,i.useState)(!1),[w,k]=(0,i.useState)(0),[N,C]=(0,i.useState)(""),[P,R]=(0,i.useState)(!1),[A,S]=(0,i.useState)(!1),[I,L]=(0,i.useState)(0),[$,E]=(0,i.useState)("good"),[F,M]=(0,i.useState)(!0),[O,_]=(0,i.useState)("motivational"),[z,T]=(0,i.useState)(!1),K=(0,i.useRef)(null),U=(0,i.useRef)(null),V=(0,i.useRef)(null),Y=new f.x;(0,i.useRef)(null);let D=async()=>{try{console.log("Starting camera request...");let e=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"}});if(console.log(`Camera stream obtained: ${e.id}`),console.log(`Stream tracks: ${e.getTracks().map(e=>e.kind).join(", ")}`),K.current){console.log("Setting video srcObject..."),K.current.srcObject=e,V.current=e,console.log("Setting isCameraOn to true..."),b(!0),j(!0);try{console.log("Attempting to play video..."),await K.current.play(),console.log("Video play() successful")}catch(e){console.error("Video play() failed:",e)}K.current.onloadedmetadata=()=>{console.log("Video loaded, starting pose detection"),console.log("Video dimensions:",K.current?.videoWidth,"x",K.current?.videoHeight),H(),setTimeout(()=>{B()},2e3)},K.current.oncanplay=()=>{console.log("Video can play")},K.current.onerror=e=>{console.error("Video error:",e)},K.current.onplay=()=>{console.log("Video play event fired")},K.current.onplaying=()=>{console.log("Video playing event fired")}}else console.error("ERROR: videoRef.current is null")}catch(e){console.error("Failed to start camera:",e),C("Camera access denied. Please enable camera permissions.")}},Z=()=>{y.stopDetection(),V.current&&(V.current.getTracks().forEach(e=>e.stop()),V.current=null),K.current&&(K.current.srcObject=null),b(!1),j(!1),L(0),E("good")},H=async()=>{if(K.current&&U.current)try{console.log("Initializing MediaPipe pose detection..."),y.setOnResults((e,t)=>{L(t.confidence),E(t.posture),t.feedback&&(C(t.feedback),s?.(t.feedback),F&&!z&&W(t.feedback)),t.repDetected&&(k(t.repCount),m?.(t.repCount),F&&!z&&G(t.repCount)),y.drawPoseLandmarks(U.current,e)});let e=await y.startDetection(K.current,U.current);e?console.log("MediaPipe pose detection started successfully"):(console.error("Failed to start pose detection"),C("Failed to initialize AI pose detection. Using fallback mode."))}catch(e){console.error("Error starting pose detection:",e),C("Error initializing AI pose detection. Using fallback mode.")}},W=async t=>{if(F&&!z){T(!0);try{let s=await Y.generateFormFeedback(e,t,O);s&&await J(s)}catch(e){console.error("Failed to generate voice feedback:",e)}finally{T(!1)}}},G=async e=>{if(F&&!z){T(!0);try{let e=await Y.generateMotivationalMessage("encouragement",O);e&&await J(e)}catch(e){console.error("Failed to generate rep count voice:",e)}finally{T(!1)}}},J=async e=>new Promise((t,s)=>{let a=new Audio(e);a.onended=()=>t(),a.onerror=()=>s(Error("Audio playback failed")),a.play().catch(s)}),B=async()=>{if(F){T(!0);try{let e=await Y.generateMotivationalMessage("start",O);e&&await J(e)}catch(e){console.error("Failed to start voice coaching:",e)}finally{T(!1)}}};return(0,i.useEffect)(()=>()=>{Z()},[]),(0,a.jsxs)("div",{className:`space-y-4 ${g}`,children:[(0,a.jsxs)(o.Zb,{children:[a.jsx(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"flex items-center gap-2",children:[a.jsx(r.Z,{className:"h-5 w-5 text-teal-400"}),"AI Form Analysis"]})}),(0,a.jsxs)(o.aY,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,a.jsxs)(o.zx,{onClick:()=>{x?Z():D()},variant:x?"destructive":"default",className:"flex items-center gap-2",children:[x?a.jsx(n.Z,{className:"h-4 w-4"}):a.jsx(r.Z,{className:"h-4 w-4"}),x?"Stop Camera":"Start Camera"]}),(0,a.jsxs)(o.zx,{onClick:()=>{S(!A)},variant:"outline",className:"flex items-center gap-2",children:[A?a.jsx(l.Z,{className:"h-4 w-4"}):a.jsx(c.Z,{className:"h-4 w-4"}),A?"Pause":"Play"]}),(0,a.jsxs)(o.zx,{onClick:()=>{R(!P)},variant:"outline",className:"flex items-center gap-2",children:[P?a.jsx(d.Z,{className:"h-4 w-4"}):a.jsx(u.Z,{className:"h-4 w-4"}),P?"Unmute":"Mute"]}),(0,a.jsxs)(o.zx,{onClick:()=>{k(0),y.resetRepCount(),m?.(0)},variant:"outline",className:"flex items-center gap-2",children:[a.jsx(h.Z,{className:"h-4 w-4"}),"Reset Reps"]}),(0,a.jsxs)(o.zx,{onClick:()=>M(!F),variant:F?"default":"outline",className:"flex items-center gap-2",children:[F?a.jsx(u.Z,{className:"h-4 w-4"}):a.jsx(d.Z,{className:"h-4 w-4"}),F?"Voice On":"Voice Off"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx("div",{className:`w-3 h-3 rounded-full ${x?"bg-green-500":"bg-red-500"}`}),a.jsx("span",{className:"text-sm text-gray-600",children:x?"Camera Active - AI Analysis Running":"Camera Inactive"})]}),x&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"AI Confidence:"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(o.Ex,{value:100*I,className:"w-20"}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:[Math.round(100*I),"%"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Posture:"}),a.jsx("div",{className:`px-2 py-1 rounded text-xs ${"good"===$?"bg-green-100 text-green-800":"needs_improvement"===$?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:"good"===$?"Good":"needs_improvement"===$?"Needs Work":"Poor"})]})]}),x&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Voice Coach:"}),a.jsx("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("select",{value:O,onChange:e=>_(e.target.value),className:"text-xs border rounded px-2 py-1 bg-white",disabled:!F,children:[a.jsx("option",{value:"motivational",children:"Motivational"}),a.jsx("option",{value:"calm",children:"Calm"}),a.jsx("option",{value:"professional",children:"Professional"}),a.jsx("option",{value:"friendly",children:"Friendly"}),a.jsx("option",{value:"energetic",children:"Energetic"})]})})]}),z&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-blue-600",children:[a.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse"}),"Voice coaching..."]})]})]})]}),(0,a.jsxs)(o.Zb,{children:[a.jsx(o.Ol,{children:a.jsx(o.ll,{children:"Live Camera Feed"})}),(0,a.jsxs)(o.aY,{children:[(0,a.jsxs)("div",{className:"relative",children:[a.jsx("video",{ref:K,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full rounded-lg border",style:{maxHeight:"400px",minHeight:"300px"},onLoadedMetadata:()=>console.log("Video metadata loaded"),onCanPlay:()=>console.log("Video can play"),onError:e=>console.error("Video error:",e)}),a.jsx("canvas",{ref:U,className:"absolute top-0 left-0 w-full h-full pointer-events-none",style:{maxHeight:"400px"}}),v&&a.jsx("div",{className:"absolute top-4 left-4 bg-black bg-opacity-50 text-white px-3 py-1 rounded text-sm",children:"AI Pose Detection Active"}),!x&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"text-4xl mb-2",children:"\uD83D\uDCF9"}),a.jsx("div",{className:"text-gray-600",children:'Click "Start Camera" to begin'})]})})]}),(0,a.jsxs)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"text-sm text-blue-800",children:[a.jsx("strong",{children:"Camera Status:"})," ",x?"Active":"Inactive"]}),a.jsx("div",{className:"text-xs text-blue-600 mt-1",children:x?"Camera is active and analyzing your form":'Click "Start Camera" to enable AI form analysis'})]})]})]}),(0,a.jsxs)(o.Zb,{children:[a.jsx(o.Ol,{children:a.jsx(o.ll,{children:"Repetition Counter"})}),a.jsx(o.aY,{children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"text-4xl font-bold text-teal-600 mb-2",children:w}),a.jsx("div",{className:"text-sm text-gray-600",children:"Repetitions Completed"})]})})]}),N&&(0,a.jsxs)(o.Zb,{children:[a.jsx(o.Ol,{children:a.jsx(o.ll,{children:"AI Form Feedback"})}),a.jsx(o.aY,{children:(0,a.jsxs)("div",{className:`border rounded-lg p-4 ${"good"===$?"bg-green-50 border-green-200":"needs_improvement"===$?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:[a.jsx("p",{className:`${"good"===$?"text-green-800":"needs_improvement"===$?"text-yellow-800":"text-red-800"}`,children:N}),I>0&&(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-600",children:["AI Confidence: ",Math.round(100*I),"%"]})]})})]}),(0,a.jsxs)(o.Zb,{children:[a.jsx(o.Ol,{children:a.jsx(o.ll,{children:"Exercise Instructions"})}),a.jsx(o.aY,{children:a.jsx("ol",{className:"space-y-2",children:t.map((e,t)=>(0,a.jsxs)("li",{className:"text-gray-700 text-sm flex items-start gap-2",children:[(0,a.jsxs)("span",{className:"text-teal-400 font-bold",children:[t+1,"."]}),a.jsx("span",{children:e})]},t))})})]}),a.jsx(o.zx,{onClick:p,className:"w-full py-3 text-lg",disabled:!x,children:"Complete Exercise"})]})}},2645:(e,t,s)=>{s.d(t,{x:()=>a});class a{constructor(){this.apiKey="sk_2f567620b909e0cd925eeb1a100c2265f2d8512ccffdea8a",this.baseUrl="https://api.elevenlabs.io/v1",this.voices={motivational:"21m00Tcm4TlvDq8ikWAM",calm:"AZnzlk1XvdvUeBnXmlld",professional:"EXAVITQu4vr4xnSDxMaL",friendly:"VR6AewLTigWG4xSOukaG",energetic:"pNInz6obpgDQGcFmaJgB"},this.apiKey||console.warn("Eleven Labs API key not found. Voice coaching features will be disabled.")}async generateExerciseInstructions(e,t,s="professional"){try{if(!this.apiKey)return null;let a=this.voices[s],i=this.formatInstructionsForVoice(e,t),o=await fetch(`${this.baseUrl}/text-to-speech/${a}`,{method:"POST",headers:{Accept:"audio/mpeg","Content-Type":"application/json","xi-api-key":this.apiKey},body:JSON.stringify({text:i,model_id:"eleven_monolingual_v1",voice_settings:{stability:.5,similarity_boost:.5}})});if(!o.ok)throw Error(`Eleven Labs API error: ${o.status}`);let r=await o.blob();return URL.createObjectURL(r)}catch(e){return console.error("Failed to generate exercise instructions:",e),null}}async generateMotivationalMessage(e,t="motivational"){try{if(!this.apiKey)return null;let s=this.voices[t],a=this.getMotivationalMessage(e),i=await fetch(`${this.baseUrl}/text-to-speech/${s}`,{method:"POST",headers:{Accept:"audio/mpeg","Content-Type":"application/json","xi-api-key":this.apiKey},body:JSON.stringify({text:a,model_id:"eleven_monolingual_v1",voice_settings:{stability:.7,similarity_boost:.7}})});if(!i.ok)throw Error(`Eleven Labs API error: ${i.status}`);let o=await i.blob();return URL.createObjectURL(o)}catch(e){return console.error("Failed to generate motivational message:",e),null}}async generateFormFeedback(e,t,s="professional"){try{if(!this.apiKey)return null;let a=this.voices[s],i=`For ${e}, remember: ${t}. Keep up the great work!`,o=await fetch(`${this.baseUrl}/text-to-speech/${a}`,{method:"POST",headers:{Accept:"audio/mpeg","Content-Type":"application/json","xi-api-key":this.apiKey},body:JSON.stringify({text:i,model_id:"eleven_monolingual_v1",voice_settings:{stability:.6,similarity_boost:.6}})});if(!o.ok)throw Error(`Eleven Labs API error: ${o.status}`);let r=await o.blob();return URL.createObjectURL(r)}catch(e){return console.error("Failed to generate form feedback:",e),null}}async generateTimingCues(e,t){try{if(!this.apiKey)return null;let s=this.voices.energetic,a=this.getTimingCue(e,t),i=await fetch(`${this.baseUrl}/text-to-speech/${s}`,{method:"POST",headers:{Accept:"audio/mpeg","Content-Type":"application/json","xi-api-key":this.apiKey},body:JSON.stringify({text:a,model_id:"eleven_monolingual_v1",voice_settings:{stability:.8,similarity_boost:.8}})});if(!i.ok)throw Error(`Eleven Labs API error: ${i.status}`);let o=await i.blob();return URL.createObjectURL(o)}catch(e){return console.error("Failed to generate timing cues:",e),null}}async generateWorkoutNarration(e,t,s="professional"){try{if(!this.apiKey)return null;let a=this.voices[s],i=this.formatWorkoutNarration(e,t),o=await fetch(`${this.baseUrl}/text-to-speech/${a}`,{method:"POST",headers:{Accept:"audio/mpeg","Content-Type":"application/json","xi-api-key":this.apiKey},body:JSON.stringify({text:i,model_id:"eleven_monolingual_v1",voice_settings:{stability:.6,similarity_boost:.6}})});if(!o.ok)throw Error(`Eleven Labs API error: ${o.status}`);let r=await o.blob();return URL.createObjectURL(r)}catch(e){return console.error("Failed to generate workout narration:",e),null}}formatInstructionsForVoice(e,t){let s=`Let's do ${e}. `;return t.forEach((e,t)=>{s+=`Step ${t+1}: ${e}. `}),s+="Great job! You're doing amazing."}getMotivationalMessage(e){let t={start:["Welcome to your workout! You're about to do something amazing for your body and mind. Let's get started!","Ready to feel stronger and more energized? Let's begin this incredible journey together!","You've made the choice to invest in yourself today. That's already a win! Let's make it count!"],during:["You're doing fantastic! Every movement is making you stronger.","Keep going! You're building strength and confidence with every rep.","You've got this! Your body is capable of incredible things.","Stay focused and breathe. You're doing exactly what you need to do."],finish:["Congratulations! You've completed your workout. You should be proud of yourself!","Amazing work! You've just given your body the gift of movement and strength.","You did it! Every exercise you completed is a step toward a healthier, stronger you."],encouragement:["You're stronger than you think. Keep pushing forward!","Every expert was once a beginner. You're on the right path!","Your future self will thank you for this workout. Keep going!","You're not just exercising, you're building a better version of yourself!"]}[e];return t[Math.floor(Math.random()*t.length)]}getTimingCue(e,t){switch(e){case"start":return"Ready? Let's begin!";case"countdown":return t?`Hold for ${t} more seconds.`:"Keep going!";case"hold":return"Hold that position. Breathe deeply.";case"release":return"Now release slowly. Great control!";case"next":return"Next exercise coming up. Get ready!";default:return"Keep going!"}}formatWorkoutNarration(e,t){let s=`Welcome to ${e}. This workout includes ${t.length} exercises designed to strengthen and energize your body. `;return t.forEach((e,t)=>{s+=`Exercise ${t+1}: ${e.name}. ${e.description}. `}),s+="Remember to listen to your body and take breaks when needed. Let's begin!"}async getAvailableVoices(){try{if(!this.apiKey)return[];let e=await fetch(`${this.baseUrl}/voices`,{headers:{"xi-api-key":this.apiKey}});if(!e.ok)throw Error(`Eleven Labs API error: ${e.status}`);let t=await e.json();return t.voices||[]}catch(e){return console.error("Failed to get available voices:",e),[]}}async testConnection(){try{if(!this.apiKey)return console.log("No Eleven Labs API key found"),!1;console.log("Testing Eleven Labs API connection...");let e=new AbortController,t=setTimeout(()=>e.abort(),5e3),s=await fetch(`${this.baseUrl}/voices`,{headers:{"xi-api-key":this.apiKey},signal:e.signal});if(clearTimeout(t),s.ok)return console.log("Eleven Labs API connection successful"),!0;return console.log(`Eleven Labs API error: ${s.status}`),!1}catch(e){return console.error("Voice coaching API test failed:",e),!1}}}}};