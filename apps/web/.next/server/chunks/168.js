"use strict";exports.id=168,exports.ids=[168],exports.modules={9168:(e,t,s)=>{s.d(t,{y:()=>j});var a=s(5402),i=s(6964),l=s(9472),n=s(1931),r=s(3750),o=s(9630),c=s(2037),d=s(3432),h=s(76),u=s(822),m=s(7427),x=s(3968),p=s(876);class g{getInitialized(){return this.isInitialized}async initialize(){try{return console.log("Initializing MediaPipe Pose..."),this.pose=new m.Pose({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${e}`}),this.pose.setOptions({modelComplexity:1,smoothLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),this.pose.onResults(e=>{this.onPoseResults(e)}),this.isInitialized=!0,console.log("MediaPipe Pose initialized successfully"),!0}catch(e){return console.error("Failed to initialize MediaPipe Pose:",e),!1}}onPoseResults(e){if(!e.poseLandmarks)return;let t=e.poseLandmarks;this.poseHistory.push(t),this.poseHistory.length>30&&this.poseHistory.shift();let s=this.analyzeForm(t);this.emitResults(e,s)}analyzeForm(e){let t={posture:"good",feedback:"",confidence:0,repDetected:!1,repCount:this.repCount},s=e.filter(e=>e.visibility&&e.visibility>.5);t.confidence=s.length/e.length;let a=this.analyzePosture(e);a>.8?(t.posture="good",t.feedback="Excellent posture! Keep it up!"):a>.6?(t.posture="needs_improvement",t.feedback="Try to straighten your back and align your shoulders."):(t.posture="poor",t.feedback="Please correct your posture. Stand tall with shoulders back.");let i=this.detectRepetition(e);return i&&(this.repCount++,t.repDetected=!0,t.repCount=this.repCount),t}analyzePosture(e){if(e.length<33)return 0;let t=e[0],s=e[11],a=e[12],i=e[23],l=e[24],n=0,r=0;if(s&&a){let e=Math.abs(s.y-a.y);n+=Math.max(0,1-10*e),r++}if(s&&a&&i&&l){let e=(s.y+a.y)/2,t=(i.y+l.y)/2;n+=Math.max(0,1-5*Math.abs(e-t)),r++}if(t&&s&&a){let e=(s.y+a.y)/2,i=Math.abs(t.y-e);n+=Math.max(0,1-3*i),r++}return r>0?n/r:0}detectRepetition(e){if(this.poseHistory.length<10)return!1;let t=e[15],s=e[16],a=e[13],i=e[14];if(!t||!s||!a||!i)return!1;let l=this.calculateAngle(t,a,e[11]),n=this.calculateAngle(s,i,e[12]),r=`${l>90?"up":"down"}_${n>90?"up":"down"}`;if(this.lastPoseState&&this.lastPoseState!==r){let e=Date.now()-(this.lastRepTime||0);if(e>1e3)return this.lastRepTime=Date.now(),this.lastPoseState=r,!0}return this.lastPoseState=r,!1}calculateAngle(e,t,s){let a=Math.atan2(s.y-t.y,s.x-t.x)-Math.atan2(e.y-t.y,e.x-t.x);return Math.abs(180*a/Math.PI)}emitResults(e,t){this.onResultsCallback&&this.onResultsCallback(e,t)}setOnResults(e){this.onResultsCallback=e}async startDetection(e,t){if(!this.pose||!this.isInitialized){let e=await this.initialize();if(!e)return!1}try{return console.log("Starting pose detection..."),this.camera=new x.Camera(e,{onFrame:async()=>{this.pose&&await this.pose.send({image:e})},width:640,height:480}),await this.camera.start(),console.log("Pose detection started successfully"),!0}catch(e){return console.error("Failed to start pose detection:",e),!1}}stopDetection(){this.camera&&(this.camera.stop(),this.camera=null),this.repCount=0,this.poseHistory=[],this.lastPoseState="",console.log("Pose detection stopped")}resetRepCount(){this.repCount=0}getRepCount(){return this.repCount}async sendImage(e){this.pose&&this.isInitialized&&await this.pose.send({image:e})}drawPoseLandmarks(e,t){let s=e.getContext("2d");s&&(s.clearRect(0,0,e.width,e.height),t.poseLandmarks&&((0,p.drawConnectors)(s,t.poseLandmarks,m.POSE_CONNECTIONS,{color:"#00FF00",lineWidth:2}),(0,p.drawLandmarks)(s,t.poseLandmarks,{color:"#FF0000",lineWidth:1,radius:3})))}constructor(){this.pose=null,this.camera=null,this.isInitialized=!1,this.repCount=0,this.lastPoseState="",this.lastRepTime=0,this.poseHistory=[],this.onResultsCallback=null}}let y=new g;var f=s(2645);function j({exerciseName:e,instructions:t,onFormFeedback:s,onRepCount:m,onComplete:x,className:p=""}){let[g,j]=(0,i.useState)(!1),[b,v]=(0,i.useState)(!1),[N,w]=(0,i.useState)(0),[C,k]=(0,i.useState)(""),[P,R]=(0,i.useState)(!1),[S,M]=(0,i.useState)(!1),[z,F]=(0,i.useState)(0),[I,A]=(0,i.useState)("good"),[O,D]=(0,i.useState)(!0),[V,Z]=(0,i.useState)("motivational"),[E,L]=(0,i.useState)(!1),H=(0,i.useRef)(null),$=(0,i.useRef)(null),T=(0,i.useRef)(null),_=new f.x;(0,i.useRef)(null);let Y=async()=>{try{console.log("Starting camera request...");let e=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"}});if(console.log(`Camera stream obtained: ${e.id}`),console.log(`Stream tracks: ${e.getTracks().map(e=>e.kind).join(", ")}`),H.current){console.log("Setting video srcObject..."),H.current.srcObject=e,T.current=e,console.log("Setting isCameraOn to true..."),j(!0),v(!0);try{console.log("Attempting to play video..."),await H.current.play(),console.log("Video play() successful")}catch(e){console.error("Video play() failed:",e)}H.current.onloadedmetadata=()=>{console.log("Video loaded, starting pose detection"),console.log("Video dimensions:",H.current?.videoWidth,"x",H.current?.videoHeight),W(),setTimeout(()=>{B()},2e3)},H.current.oncanplay=()=>{console.log("Video can play")},H.current.onerror=e=>{console.error("Video error:",e)},H.current.onplay=()=>{console.log("Video play event fired")},H.current.onplaying=()=>{console.log("Video playing event fired")}}else console.error("ERROR: videoRef.current is null")}catch(e){console.error("Failed to start camera:",e),k("Camera access denied. Please enable camera permissions.")}},U=()=>{y.stopDetection(),T.current&&(T.current.getTracks().forEach(e=>e.stop()),T.current=null),H.current&&(H.current.srcObject=null),j(!1),v(!1),F(0),A("good")},W=async()=>{if(H.current&&$.current)try{console.log("Initializing MediaPipe pose detection..."),y.setOnResults((e,t)=>{F(t.confidence),A(t.posture),t.feedback&&(k(t.feedback),s?.(t.feedback),O&&!E&&q(t.feedback)),t.repDetected&&(w(t.repCount),m?.(t.repCount),O&&!E&&G(t.repCount)),y.drawPoseLandmarks($.current,e)});let e=await y.startDetection(H.current,$.current);e?console.log("MediaPipe pose detection started successfully"):(console.error("Failed to start pose detection"),k("Failed to initialize AI pose detection. Using fallback mode."))}catch(e){console.error("Error starting pose detection:",e),k("Error initializing AI pose detection. Using fallback mode.")}},q=async t=>{if(O&&!E){L(!0);try{let s=await _.generateFormFeedback(e,t,V);s&&await K(s)}catch(e){console.error("Failed to generate voice feedback:",e)}finally{L(!1)}}},G=async e=>{if(O&&!E){L(!0);try{let e=await _.generateMotivationalMessage("encouragement",V);e&&await K(e)}catch(e){console.error("Failed to generate rep count voice:",e)}finally{L(!1)}}},K=async e=>new Promise((t,s)=>{let a=new Audio(e);a.onended=()=>t(),a.onerror=()=>s(Error("Audio playback failed")),a.play().catch(s)}),B=async()=>{if(O){L(!0);try{let e=await _.generateMotivationalMessage("start",V);e&&await K(e)}catch(e){console.error("Failed to start voice coaching:",e)}finally{L(!1)}}};return(0,i.useEffect)(()=>()=>{U()},[]),(0,a.jsxs)("div",{className:`space-y-4 ${p}`,children:[(0,a.jsxs)(l.Zb,{children:[a.jsx(l.Ol,{children:(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[a.jsx(n.Z,{className:"h-5 w-5 text-teal-400"}),"AI Form Analysis"]})}),(0,a.jsxs)(l.aY,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,a.jsxs)(l.zx,{onClick:()=>{g?U():Y()},variant:g?"destructive":"default",className:"flex items-center gap-2",children:[g?a.jsx(r.Z,{className:"h-4 w-4"}):a.jsx(n.Z,{className:"h-4 w-4"}),g?"Stop Camera":"Start Camera"]}),(0,a.jsxs)(l.zx,{onClick:()=>{M(!S)},variant:"outline",className:"flex items-center gap-2",children:[S?a.jsx(o.Z,{className:"h-4 w-4"}):a.jsx(c.Z,{className:"h-4 w-4"}),S?"Pause":"Play"]}),(0,a.jsxs)(l.zx,{onClick:()=>{R(!P)},variant:"outline",className:"flex items-center gap-2",children:[P?a.jsx(d.Z,{className:"h-4 w-4"}):a.jsx(h.Z,{className:"h-4 w-4"}),P?"Unmute":"Mute"]}),(0,a.jsxs)(l.zx,{onClick:()=>{w(0),y.resetRepCount(),m?.(0)},variant:"outline",className:"flex items-center gap-2",children:[a.jsx(u.Z,{className:"h-4 w-4"}),"Reset Reps"]}),(0,a.jsxs)(l.zx,{onClick:()=>D(!O),variant:O?"default":"outline",className:"flex items-center gap-2",children:[O?a.jsx(h.Z,{className:"h-4 w-4"}):a.jsx(d.Z,{className:"h-4 w-4"}),O?"Voice On":"Voice Off"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx("div",{className:`w-3 h-3 rounded-full ${g?"bg-green-500":"bg-red-500"}`}),a.jsx("span",{className:"text-sm text-gray-600",children:g?"Camera Active - AI Analysis Running":"Camera Inactive"})]}),g&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"AI Confidence:"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(l.Ex,{value:100*z,className:"w-20"}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:[Math.round(100*z),"%"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Posture:"}),a.jsx("div",{className:`px-2 py-1 rounded text-xs ${"good"===I?"bg-green-100 text-green-800":"needs_improvement"===I?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:"good"===I?"Good":"needs_improvement"===I?"Needs Work":"Poor"})]})]}),g&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Voice Coach:"}),a.jsx("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("select",{value:V,onChange:e=>Z(e.target.value),className:"text-xs border rounded px-2 py-1 bg-white",disabled:!O,children:[a.jsx("option",{value:"motivational",children:"Motivational"}),a.jsx("option",{value:"calm",children:"Calm"}),a.jsx("option",{value:"professional",children:"Professional"}),a.jsx("option",{value:"friendly",children:"Friendly"}),a.jsx("option",{value:"energetic",children:"Energetic"})]})})]}),E&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-blue-600",children:[a.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse"}),"Voice coaching..."]})]})]})]}),(0,a.jsxs)(l.Zb,{children:[a.jsx(l.Ol,{children:a.jsx(l.ll,{children:"Live Camera Feed"})}),(0,a.jsxs)(l.aY,{children:[(0,a.jsxs)("div",{className:"relative",children:[a.jsx("video",{ref:H,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full rounded-lg border",style:{maxHeight:"400px",minHeight:"300px"},onLoadedMetadata:()=>console.log("Video metadata loaded"),onCanPlay:()=>console.log("Video can play"),onError:e=>console.error("Video error:",e)}),a.jsx("canvas",{ref:$,className:"absolute top-0 left-0 w-full h-full pointer-events-none",style:{maxHeight:"400px"}}),b&&a.jsx("div",{className:"absolute top-4 left-4 bg-black bg-opacity-50 text-white px-3 py-1 rounded text-sm",children:"AI Pose Detection Active"}),!g&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"text-4xl mb-2",children:"\uD83D\uDCF9"}),a.jsx("div",{className:"text-gray-600",children:'Click "Start Camera" to begin'})]})})]}),(0,a.jsxs)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"text-sm text-blue-800",children:[a.jsx("strong",{children:"Camera Status:"})," ",g?"Active":"Inactive"]}),a.jsx("div",{className:"text-xs text-blue-600 mt-1",children:g?"Camera is active and analyzing your form":'Click "Start Camera" to enable AI form analysis'})]})]})]}),(0,a.jsxs)(l.Zb,{children:[a.jsx(l.Ol,{children:a.jsx(l.ll,{children:"Repetition Counter"})}),a.jsx(l.aY,{children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"text-4xl font-bold text-teal-600 mb-2",children:N}),a.jsx("div",{className:"text-sm text-gray-600",children:"Repetitions Completed"})]})})]}),C&&(0,a.jsxs)(l.Zb,{children:[a.jsx(l.Ol,{children:a.jsx(l.ll,{children:"AI Form Feedback"})}),a.jsx(l.aY,{children:(0,a.jsxs)("div",{className:`border rounded-lg p-4 ${"good"===I?"bg-green-50 border-green-200":"needs_improvement"===I?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:[a.jsx("p",{className:`${"good"===I?"text-green-800":"needs_improvement"===I?"text-yellow-800":"text-red-800"}`,children:C}),z>0&&(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-600",children:["AI Confidence: ",Math.round(100*z),"%"]})]})})]}),(0,a.jsxs)(l.Zb,{children:[a.jsx(l.Ol,{children:a.jsx(l.ll,{children:"Exercise Instructions"})}),a.jsx(l.aY,{children:a.jsx("ol",{className:"space-y-2",children:t.map((e,t)=>(0,a.jsxs)("li",{className:"text-gray-700 text-sm flex items-start gap-2",children:[(0,a.jsxs)("span",{className:"text-teal-400 font-bold",children:[t+1,"."]}),a.jsx("span",{children:e})]},t))})})]}),a.jsx(l.zx,{onClick:x,className:"w-full py-3 text-lg",disabled:!g,children:"Complete Exercise"})]})}}};