"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[25],{25:function(e,t,s){s.r(t),s.d(t,{AutomatedPhotoCapture:function(){return j}});var i=s(7573),r=s(7653),a=s(4001),o=s(638),n=s(9690),l=s(3747),c=s(7342),d=s(206),h=s(5453),u=s(7103),p=s(5592),g=s(8121),m=s(5021),f=s(7277);class x{initializeCaptureSteps(){this.captureSteps=[{type:"front",name:"Front View",description:"Stand facing the camera with good posture",instructions:["Stand 6-8 feet from the camera","Face the camera directly","Keep your arms slightly away from your body","Stand with feet shoulder-width apart","Look straight ahead","Maintain natural posture"],positioningGuide:{distance:7,height:80,width:60,posture:["Stand straight with shoulders back","Keep your head level","Arms slightly away from body","Feet shoulder-width apart"],clothing:["Wear form-fitting but comfortable clothing","Avoid baggy clothes that hide body shape","Consider wearing the same outfit for consistency"],lighting:["Ensure even lighting from the front","Avoid harsh shadows","Natural light is preferred"],background:["Use a plain, neutral background","Avoid cluttered or busy backgrounds","Ensure good contrast with your clothing"]},isCompleted:!1},{type:"side",name:"Side View",description:"Turn 90 degrees to show your profile",instructions:["Turn 90 degrees to your right","Keep your head facing forward","Maintain the same posture as front view","Arms slightly away from body","Stand naturally"],positioningGuide:{distance:7,height:80,width:60,posture:["Turn 90 degrees to the right","Keep head facing forward","Maintain straight posture","Arms slightly away from body"],clothing:["Same clothing as front view","Ensure clothing shows body shape clearly"],lighting:["Ensure even lighting from the side","Avoid harsh shadows on face and body"],background:["Same background as front view","Ensure good contrast"]},isCompleted:!1},{type:"back",name:"Back View",description:"Turn to show your back view",instructions:["Turn 180 degrees from front view","Face away from the camera","Keep your head level","Maintain good posture","Arms slightly away from body"],positioningGuide:{distance:7,height:80,width:60,posture:["Turn 180 degrees from front position","Face away from camera","Keep head level and straight","Maintain straight posture","Arms slightly away from body"],clothing:["Same clothing as previous views","Ensure back is clearly visible"],lighting:["Ensure even lighting on back","Avoid shadows that hide definition"],background:["Same background as previous views","Good contrast with clothing"]},isCompleted:!1},{type:"full_body",name:"Full Body View",description:"Step back to show your full body",instructions:["Step back 2-3 feet further","Ensure your entire body is visible","Maintain the same posture","Keep your head level","Arms slightly away from body"],positioningGuide:{distance:10,height:90,width:70,posture:["Stand 10 feet from camera","Ensure full body is in frame","Maintain straight posture","Head level, arms slightly away"],clothing:["Same clothing as all previous views","Ensure full body is clearly visible"],lighting:["Ensure even lighting on entire body","Avoid shadows that hide body shape"],background:["Same background as previous views","Ensure full body stands out clearly"]},isCompleted:!1}]}startCaptureSession(e){let t={id:this.generateId(),userId:e,date:new Date().toISOString().split("T")[0],status:"preparing",currentStep:this.captureSteps[0],photos:[],instructions:[],startTime:new Date().toISOString()};return this.currentSession=t,this.isCapturing=!0,this.addVoiceInstruction({id:this.generateId(),text:"Welcome to your progress photo session! I'll guide you through each position to ensure consistent, high-quality photos.",priority:"high",timing:"immediate"}),this.addVoiceInstruction({id:this.generateId(),text:"Let's start with the front view. Please stand 6-8 feet from the camera and face me directly.",priority:"high",timing:"immediate"}),t}getCurrentSession(){return this.currentSession}addVoiceInstruction(e){this.voiceQueue.push(e),this.speakInstruction(e)}speakInstruction(e){if("speechSynthesis"in window){let t=new SpeechSynthesisUtterance(e.text);t.rate=.9,t.pitch=1,t.volume=1;let s=speechSynthesis.getVoices(),i=s.find(e=>e.lang.includes("en")&&e.name.includes("Google"))||s.find(e=>e.lang.includes("en"));i&&(t.voice=i),speechSynthesis.speak(t)}}analyzePositioning(e){let t={isInPosition:Math.random()>.3,quality:Math.floor(40*Math.random())+60,recommendations:["Move slightly to the left","Stand a bit closer to the camera","Straighten your posture"].slice(0,Math.floor(3*Math.random())+1)};return t}async capturePhoto(e){if(!this.currentSession||!this.isCapturing)return null;try{let t=document.createElement("canvas"),s=t.getContext("2d");if(!s)throw Error("Could not get canvas context");t.width=e.videoWidth,t.height=e.videoHeight,s.drawImage(e,0,0,t.width,t.height);let i=await new Promise(e=>{t.toBlob(t=>{t&&e(t)},"image/jpeg",.9)}),r=URL.createObjectURL(i),a=await this.createThumbnail(i),o=this.analyzeCapturedPhoto(i),n={id:this.generateId(),type:this.currentSession.currentStep.type,imageUrl:r,thumbnailUrl:a,metadata:{timestamp:new Date().toISOString(),quality:o.quality,lighting:Math.floor(30*Math.random())+70,positioning:Math.floor(30*Math.random())+70,blur:Math.floor(20*Math.random())+10},analysis:{bodyDetected:o.bodyDetected,faceDetected:o.faceDetected,poseQuality:o.poseQuality,recommendations:o.recommendations}};return this.currentSession.photos.push(n),this.currentSession.currentStep.photoId=n.id,this.currentSession.currentStep.isCompleted=!0,this.addVoiceInstruction({id:this.generateId(),text:"Great! ".concat(this.currentSession.currentStep.name," captured successfully."),priority:"medium",timing:"after_capture"}),n}catch(e){return console.error("Error capturing photo:",e),this.addVoiceInstruction({id:this.generateId(),text:"There was an issue capturing the photo. Let's try again.",priority:"high",timing:"immediate",action:"retake"}),null}}async createThumbnail(e){return new Promise(t=>{let s=document.createElement("canvas"),i=s.getContext("2d"),r=new Image;r.onload=()=>{if(!i){t(URL.createObjectURL(e));return}let a=Math.min(200/r.width,200/r.height);s.width=r.width*a,s.height=r.height*a,i.drawImage(r,0,0,s.width,s.height),s.toBlob(s=>{s?t(URL.createObjectURL(s)):t(URL.createObjectURL(e))},"image/jpeg",.8)},r.src=URL.createObjectURL(e)})}analyzeCapturedPhoto(e){return{bodyDetected:Math.random()>.1,faceDetected:Math.random()>.2,poseQuality:Math.floor(40*Math.random())+60,quality:Math.floor(30*Math.random())+70,recommendations:["Good positioning!","Lighting looks great","Posture is excellent"].slice(0,Math.floor(3*Math.random())+1)}}nextStep(){if(!this.currentSession)return null;let e=this.captureSteps.findIndex(e=>e.type===this.currentSession.currentStep.type);if(!(e<this.captureSteps.length-1))return this.completeSession(),null;{let t=this.captureSteps[e+1];return this.currentSession.currentStep=t,this.addVoiceInstruction({id:this.generateId(),text:"Now let's capture the ".concat(t.name.toLowerCase(),". ").concat(t.instructions[0]),priority:"high",timing:"immediate"}),t}}completeSession(){this.currentSession&&(this.currentSession.status="completed",this.currentSession.endTime=new Date().toISOString(),this.isCapturing=!1,this.addVoiceInstruction({id:this.generateId(),text:"Excellent! All progress photos have been captured successfully. Your photos are now saved to your profile.",priority:"high",timing:"immediate"}),this.savePhotosToProfile())}savePhotosToProfile(){this.currentSession&&Promise.resolve().then(s.bind(s,2058)).then(e=>{let{userProfileService:t}=e;this.currentSession.photos.forEach(e=>{let s={userId:this.currentSession.userId,date:this.currentSession.date,type:e.type,imageUrl:e.imageUrl,thumbnailUrl:e.thumbnailUrl,weight:void 0,bodyFat:void 0,muscleMass:void 0,notes:"Automated capture - ".concat(e.type," view"),isPrivate:!0,tags:[e.type,"automated","progress"]};t.addProgressPhoto(s)})})}retakeCurrentStep(){if(!this.currentSession)return;this.currentSession.currentStep.isCompleted=!1,this.currentSession.currentStep.photoId=void 0;let e=this.currentSession.photos[this.currentSession.photos.length-1];e&&e.type===this.currentSession.currentStep.type&&this.currentSession.photos.pop(),this.addVoiceInstruction({id:this.generateId(),text:"Let's retake the ".concat(this.currentSession.currentStep.name.toLowerCase(),". ").concat(this.currentSession.currentStep.instructions[0]),priority:"high",timing:"immediate"})}getPositioningFeedback(e){let t=this.analyzePositioning(e);return t.isInPosition?{isInPosition:!0,feedback:["Perfect position!","Ready to capture"],nextInstruction:"Hold still, capturing in 3... 2... 1..."}:{isInPosition:!1,feedback:t.recommendations,nextInstruction:"Please adjust your position and try again"}}stopSession(){this.currentSession&&(this.currentSession.status="failed",this.currentSession.endTime=new Date().toISOString()),this.isCapturing=!1,this.currentSession=null,"speechSynthesis"in window&&speechSynthesis.cancel()}getSessionProgress(){if(!this.currentSession)return{currentStep:0,totalSteps:this.captureSteps.length,percentage:0,remainingSteps:this.captureSteps.map(e=>e.name)};let e=this.captureSteps.findIndex(e=>e.type===this.currentSession.currentStep.type),t=this.captureSteps.filter(e=>e.isCompleted).length,s=t/this.captureSteps.length*100,i=this.captureSteps.slice(e+1).map(e=>e.name);return{currentStep:e+1,totalSteps:this.captureSteps.length,percentage:Math.round(s),remainingSteps:i}}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}constructor(){this.currentSession=null,this.isCapturing=!1,this.voiceQueue=[],this.captureSteps=[],this.initializeCaptureSteps()}}let y=new x;var v=s(2058),S=s(5319),w=s.n(S);let b=e=>{let{videoElement:t,photoType:s,onPositionUpdate:a,className:o="",videoDimensions:n}=e,[l,c]=(0,r.useState)(!0),[d,h]=(0,r.useState)(!1),u=(0,r.useRef)(null),p=(0,r.useRef)(null);return((0,r.useEffect)(()=>{t&&t.readyState>=2&&setTimeout(()=>{h(!0),null==a||a(!0,["Perfect position!"])},2e3)},[t,a]),(0,r.useEffect)(()=>{if(l&&u.current&&t){let e=u.current,t=e.getContext("2d");if(t){let s=p.current;s&&(e.width=s.clientWidth,e.height=s.clientHeight),t.clearRect(0,0,e.width,e.height),t.strokeStyle="#00ff00",t.lineWidth=3,t.beginPath();let i=e.width/2,r=e.height/2,a=.3*Math.min(e.width,e.height);t.arc(i,r-.8*a,.15*a,0,2*Math.PI),t.moveTo(i,r-.6*a),t.lineTo(i,r+.4*a),t.moveTo(i-.3*a,r-.2*a),t.lineTo(i+.3*a,r-.2*a),t.moveTo(i,r+.4*a),t.lineTo(i-.2*a,r+.8*a),t.moveTo(i,r+.4*a),t.lineTo(i+.2*a,r+.8*a),t.stroke()}}},[l,t]),t)?(0,i.jsxs)("div",{ref:p,style:{zIndex:99999,position:"absolute",top:0,left:0,width:"100%",height:"100%"},className:"jsx-e0ba8980a1a0dd1d "+"absolute inset-0 pointer-events-none ".concat(o),children:[l&&(0,i.jsx)("canvas",{ref:u,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:99998,pointerEvents:"none"},className:"jsx-e0ba8980a1a0dd1d"}),(0,i.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:99999,fontSize:"6rem",fontWeight:"bold",color:"white",textShadow:"0 0 20px white, 0 0 40px white, 0 0 60px white, 0 0 80px white",filter:"drop-shadow(0 0 10px white) drop-shadow(0 0 20px white)",animation:"pulse 2s infinite"},className:"jsx-e0ba8980a1a0dd1d",children:"✕"}),(0,i.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80px",height:"80px",border:"3px solid #00ff00",backgroundColor:"rgba(0, 255, 0, 0.1)",borderRadius:"50%",zIndex:99997,animation:d?"pulse 1s infinite":"none"},className:"jsx-e0ba8980a1a0dd1d"}),(0,i.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"60%",height:"85%",border:"2px dashed #00ff00",backgroundColor:"rgba(0, 255, 0, 0.05)",borderRadius:"8px",zIndex:99996},className:"jsx-e0ba8980a1a0dd1d"}),(0,i.jsxs)("div",{style:{position:"absolute",top:"10px",left:"10px",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",padding:"8px 12px",borderRadius:"4px",fontSize:"12px",zIndex:99999,display:"flex",alignItems:"center",gap:"8px"},className:"jsx-e0ba8980a1a0dd1d",children:[(0,i.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:d?"#00ff00":"#ffaa00",animation:d?"pulse 1s infinite":"none"},className:"jsx-e0ba8980a1a0dd1d"}),d?"Position: Optimal":"Position: Adjusting..."]}),(0,i.jsxs)("button",{onClick:()=>c(!l),style:{position:"absolute",top:"10px",right:"10px",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",padding:"8px 12px",borderRadius:"4px",fontSize:"12px",zIndex:99999,border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},className:"jsx-e0ba8980a1a0dd1d",children:[(0,i.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:l?"#00ff00":"#666"},className:"jsx-e0ba8980a1a0dd1d"}),"Skeleton: ",l?"ON":"OFF"]}),(0,i.jsx)("div",{style:{position:"absolute",bottom:"60px",left:"50%",transform:"translateX(-50%)",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",padding:"8px 16px",borderRadius:"20px",fontSize:"14px",zIndex:99999,textAlign:"center",maxWidth:"80%"},className:"jsx-e0ba8980a1a0dd1d",children:'Stand on the X mark • 6-8 feet from camera • Say "ready" when positioned'}),(0,i.jsx)(w(),{id:"e0ba8980a1a0dd1d",children:"@-webkit-keyframes pulse{0%{opacity:1}50%{opacity:.7}100%{opacity:1}}@-moz-keyframes pulse{0%{opacity:1}50%{opacity:.7}100%{opacity:1}}@-o-keyframes pulse{0%{opacity:1}50%{opacity:.7}100%{opacity:1}}@keyframes pulse{0%{opacity:1}50%{opacity:.7}100%{opacity:1}}"})]}):null},j=e=>{let{className:t="",onComplete:s,onCancel:x}=e,[S,w]=(0,r.useState)(null),[j,k]=(0,r.useState)(!1),[N,P]=(0,r.useState)(!1),[I,C]=(0,r.useState)(!0),[M,U]=(0,r.useState)(!1),[D,T]=(0,r.useState)(!1),[E,F]=(0,r.useState)([]),[R,z]=(0,r.useState)([]),[V,A]=(0,r.useState)(!1),[O,L]=(0,r.useState)(null),[_,W]=(0,r.useState)(null),[Z,B]=(0,r.useState)(null),[G,H]=(0,r.useState)({width:0,height:0}),Y=(0,r.useRef)(null),q=(0,r.useRef)(null),K=(0,r.useRef)(null),Q=(0,r.useRef)(null),J=(0,r.useRef)(null),X=(0,r.useRef)(null);(0,r.useEffect)(()=>()=>{q.current&&q.current.getTracks().forEach(e=>e.stop()),K.current&&clearInterval(K.current),Q.current&&clearInterval(Q.current),X.current&&clearInterval(X.current),J.current&&J.current.stop(),y.stopSession()},[]),(0,r.useEffect)(()=>{console.log("Camera effect triggered:",{session:!!S,isCameraActive:j}),S&&!j&&(console.log("Session started, initializing camera..."),ei())},[S,j]),(0,r.useEffect)(()=>{S&&I&&(console.log("Starting voice instructions..."),$())},[S,I]);let $=()=>{Q.current&&clearInterval(Q.current),y.addVoiceInstruction({id:"initial",text:'Welcome to your progress photo session. You should see a HUGE WHITE X MARK in the center of your screen. Stand directly on top of this X mark, about 6 to 8 feet from the camera. Say "ready" when you\'re positioned on the X.',priority:"high",timing:"immediate"});let e={id:"step",text:"For the ".concat(null==S?void 0:S.currentStep.name,", ").concat(null==S?void 0:S.currentStep.description,". ").concat(null==S?void 0:S.currentStep.instructions.join(". "),'. Look for the HUGE WHITE X MARK in the center of your screen and stand directly on top of it. When you\'re ready, say "ready" or "okay".'),priority:"high",timing:"immediate"};y.addVoiceInstruction(e),ee(),Q.current=setInterval(()=>{S&&I&&!M&&y.addVoiceInstruction({id:"encouragement",text:"You're doing great! Look for the green target area with the X mark in the center of your screen. Stand in the center of that area and say \"ready\" when you're positioned correctly.",priority:"medium",timing:"immediate"})},15e3)},ee=()=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){console.log("Speech recognition not supported");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;J.current=new e,J.current.continuous=!0,J.current.interimResults=!1,J.current.lang="en-US",J.current.onstart=()=>{console.log("Voice recognition started"),U(!0)},J.current.onresult=e=>{let t=e.results[e.results.length-1][0].transcript.toLowerCase();console.log("Heard:",t),t.includes("ready")||t.includes("okay")||t.includes("ok")?et():t.includes("capture")||t.includes("take photo")?ea():(t.includes("stop")||t.includes("cancel"))&&eo()},J.current.onerror=e=>{console.error("Speech recognition error:",e.error),U(!1)},J.current.onend=()=>{console.log("Voice recognition ended"),U(!1),setTimeout(()=>{S&&I&&ee()},1e3)};try{J.current.start()}catch(e){console.error("Error starting voice recognition:",e)}},et=()=>{if(D)es();else if("speechSynthesis"in window){let e=new SpeechSynthesisUtterance(E.length>0?E[0]:"I can see you're not quite in the right position yet. Please adjust your position and try again.");speechSynthesis.speak(e)}},es=()=>{if(W(3),"speechSynthesis"in window){let e=new SpeechSynthesisUtterance("Perfect! Starting countdown in 3, 2, 1...");speechSynthesis.speak(e)}X.current=setInterval(()=>{W(e=>null===e||e<=1?(clearInterval(X.current),ea(),null):e-1)},1e3)},ei=async()=>{try{if(console.log("Starting camera..."),B(null),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw Error("getUserMedia is not supported in this browser");let e=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"}});console.log("Camera stream obtained:",e),console.log("Video tracks:",e.getVideoTracks());let t=0;for(;!Y.current&&t<20;)console.log("Waiting for video ref... attempt ".concat(t+1)),await new Promise(e=>setTimeout(e,100)),t++;if(Y.current){console.log("Video ref found, setting stream..."),Y.current.srcObject=e,q.current=e,Y.current.onloadedmetadata=()=>{if(console.log("Video metadata loaded"),Y.current){let e=Y.current.videoWidth,t=Y.current.videoHeight;console.log("Video dimensions:",e,"x",t),H({width:e,height:t})}},Y.current.oncanplay=()=>{console.log("Video can play")},Y.current.onplay=()=>{console.log("Video started playing"),k(!0)},Y.current.onerror=e=>{console.error("Video error:",e),B("Video playback error occurred")};let t=0;for(;t<3;)try{await Y.current.play(),console.log("Video play() successful");break}catch(e){if(console.error("Error playing video (attempt ".concat(t+1,"):"),e),++t>=3)throw Error("Failed to start video playback after multiple attempts");await new Promise(e=>setTimeout(e,500))}}else throw console.error("Video ref is still null after waiting"),Error("Video element not available")}catch(e){console.error("Error accessing camera:",e),B("Unable to access camera: ".concat(e.message,". Please check permissions.")),alert("Camera Error: ".concat(e.message,". Please check camera permissions and try again."))}},er=async()=>{console.log("Start session button clicked");let e=v.userProfileService.getCurrentProfile();if(!e){console.log("No user profile found, creating sample profile");let e={id:"test-user-1",firstName:"Test",lastName:"User",displayName:"Test User",email:"test@example.com",height:{feet:5,inches:9,centimeters:175},weight:{pounds:154,kilograms:70},fitnessLevel:"beginner",fitnessGoals:["weight loss","strength"],activityLevel:"moderately_active",timezone:"America/New_York",language:"en",units:"imperial",privacySettings:{profileVisibility:"private",progressPhotos:"private",weightData:"private",workoutHistory:"private",achievements:"private"},preferences:{workoutDuration:30,workoutFrequency:3,preferredWorkoutTime:"evening",voiceCoachStyle:"motivational",notifications:{workoutReminders:!0,progressUpdates:!0,achievements:!0,weeklyReports:!0}},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};v.userProfileService.updateProfile(e)}console.log("Starting capture session...");let t=y.startCaptureSession((null==e?void 0:e.id)||"test-user-1");console.log("Session created:",t),w(t)},ea=async()=>{if(Y.current&&S){P(!0);try{let e=await y.capturePhoto(Y.current);e&&(z(t=>[...t,e]),L(e),A(!0))}catch(e){console.error("Error capturing photo:",e)}finally{P(!1)}}},eo=()=>{y.stopSession(),q.current&&q.current.getTracks().forEach(e=>e.stop()),K.current&&clearInterval(K.current),Q.current&&clearInterval(Q.current),X.current&&clearInterval(X.current),J.current&&J.current.stop(),W(null),U(!1),k(!1),B(null),x&&x()},en=y.getSessionProgress();return S?(0,i.jsxs)("div",{className:"space-y-6 ".concat(t),children:[(0,i.jsxs)(a.Zb,{children:[(0,i.jsx)(a.Ol,{children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)(a.ll,{className:"flex items-center gap-2",children:[(0,i.jsx)(o.Z,{className:"h-5 w-5 text-blue-500"}),"Progress Photo Session"]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)(a.zx,{variant:"outline",size:"sm",onClick:()=>{let e=!I;C(e),"speechSynthesis"in window&&I&&speechSynthesis.cancel(),e&&S?$():Q.current&&clearInterval(Q.current)},className:"flex items-center gap-2",children:[I?(0,i.jsx)(n.Z,{className:"h-4 w-4"}):(0,i.jsx)(l.Z,{className:"h-4 w-4"}),I?"Voice On":"Voice Off"]}),(0,i.jsxs)(a.zx,{variant:"outline",size:"sm",onClick:eo,className:"flex items-center gap-2 text-red-600",children:[(0,i.jsx)(c.Z,{className:"h-4 w-4"}),"Stop Session"]})]})]})}),(0,i.jsx)(a.aY,{children:(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[(0,i.jsxs)("span",{children:["Step ",en.currentStep," of ",en.totalSteps]}),(0,i.jsxs)("span",{children:[en.percentage,"% Complete"]})]}),(0,i.jsx)(a.Ex,{value:en.percentage,className:"h-2"})]}),(0,i.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,i.jsx)("h3",{className:"font-semibold text-blue-800 mb-2",children:S.currentStep.name}),(0,i.jsx)("p",{className:"text-blue-700 text-sm mb-3",children:S.currentStep.description}),(0,i.jsx)("div",{className:"space-y-1",children:S.currentStep.instructions.map((e,t)=>(0,i.jsxs)("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[(0,i.jsx)(d.Z,{className:"h-3 w-3"}),e]},t))})]}),en.remainingSteps.length>0&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"Remaining Steps:"}),(0,i.jsx)("div",{className:"flex flex-wrap gap-2",children:en.remainingSteps.map((e,t)=>(0,i.jsx)(a.Ct,{variant:"outline",className:"text-xs",children:e},t))})]})]})})]}),(0,i.jsxs)(a.Zb,{children:[(0,i.jsx)(a.Ol,{children:(0,i.jsxs)(a.ll,{className:"flex items-center gap-2",children:[(0,i.jsx)(h.Z,{className:"h-5 w-5 text-green-500"}),"Camera Feed"]})}),(0,i.jsx)(a.aY,{children:(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden",children:[(0,i.jsx)("video",{ref:Y,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-96 object-cover",style:{minHeight:"384px"}}),(0,i.jsxs)("div",{className:"absolute top-2 left-2 bg-black bg-opacity-70 text-white px-2 py-1 rounded text-xs z-10",children:["Camera: ",j?"Active":"Inactive"]}),(0,i.jsxs)("div",{className:"absolute top-2 right-2 bg-black bg-opacity-70 text-white px-2 py-1 rounded text-xs z-10",children:["Voice: ",M?"\uD83C\uDFA4 Listening":"\uD83D\uDD07 Idle"]}),null!==_&&(0,i.jsx)("div",{className:"absolute inset-0 flex items-center justify-center z-20",children:(0,i.jsx)("div",{className:"bg-black bg-opacity-80 text-white text-8xl font-bold rounded-full w-32 h-32 flex items-center justify-center",children:_})}),(0,i.jsx)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex items-center gap-2 z-10",children:(0,i.jsxs)(a.zx,{onClick:ea,disabled:N||!D,className:"flex items-center gap-2",children:[(0,i.jsx)(o.Z,{className:"h-4 w-4"}),N?"Capturing...":"Capture Photo"]})}),S&&j&&Y.current&&(0,i.jsx)(b,{videoElement:Y.current,photoType:S.currentStep.type,onPositionUpdate:(e,t)=>{T(e),F(t)},videoDimensions:G})]}),Z&&(0,i.jsxs)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,i.jsxs)("div",{className:"text-sm text-red-800",children:[(0,i.jsx)("strong",{children:"Camera Error:"})," ",Z]}),(0,i.jsx)(a.zx,{onClick:ei,variant:"outline",size:"sm",className:"mt-2",children:"Retry Camera"})]}),j&&(0,i.jsxs)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,i.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,i.jsx)("strong",{children:"Position Status:"})," ",D?"Optimal":"Needs Adjustment"]}),E.length>0&&(0,i.jsx)("div",{className:"mt-2 text-xs text-blue-600",children:E[0]})]})]})})]}),R.length>0&&(0,i.jsxs)(a.Zb,{children:[(0,i.jsx)(a.Ol,{children:(0,i.jsxs)(a.ll,{className:"flex items-center gap-2",children:[(0,i.jsx)(u.Z,{className:"h-5 w-5 text-green-500"}),"Captured Photos (",R.length,"/",en.totalSteps,")"]})}),(0,i.jsxs)(a.aY,{children:[(0,i.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:R.map(e=>(0,i.jsxs)(m.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"relative group cursor-pointer",onClick:()=>{L(e),A(!0)},children:[(0,i.jsxs)("div",{className:"aspect-[3/4] rounded-lg overflow-hidden bg-gray-100",children:[(0,i.jsx)("img",{src:e.thumbnailUrl,alt:"".concat(e.type," view"),className:"w-full h-full object-cover"}),(0,i.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center",children:(0,i.jsx)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:(0,i.jsx)(u.Z,{className:"h-6 w-6 text-white"})})})]}),(0,i.jsxs)("div",{className:"mt-2 text-center",children:[(0,i.jsx)("div",{className:"text-sm font-medium capitalize",children:e.type}),(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:["Quality: ",e.metadata.quality,"%"]})]})]},e.id))}),(0,i.jsxs)("div",{className:"flex justify-center gap-4 mt-6",children:[(0,i.jsxs)(a.zx,{variant:"outline",onClick:()=>{y.retakeCurrentStep(),w(y.getCurrentSession()),z(e=>e.slice(0,-1))},className:"flex items-center gap-2",children:[(0,i.jsx)(p.Z,{className:"h-4 w-4"}),"Retake Current"]}),(0,i.jsxs)(a.zx,{onClick:()=>{let e=y.nextStep();if(e)w(y.getCurrentSession());else{let e=y.getCurrentSession();e&&s&&s(e.photos)}},disabled:!S.currentStep.isCompleted,className:"flex items-center gap-2",children:[en.currentStep===en.totalSteps?"Complete Session":"Next Step",(0,i.jsx)(g.Z,{className:"h-4 w-4"})]})]})]})]}),(0,i.jsx)(f.M,{children:V&&O&&(0,i.jsx)(m.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>A(!1),children:(0,i.jsxs)(m.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4",onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,i.jsxs)("h3",{className:"text-lg font-bold",children:[O.type.charAt(0).toUpperCase()+O.type.slice(1)," View"]}),(0,i.jsx)(a.zx,{variant:"ghost",size:"sm",onClick:()=>A(!1),children:(0,i.jsx)(c.Z,{className:"h-4 w-4"})})]}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("div",{className:"aspect-[3/4] rounded-lg overflow-hidden bg-gray-100",children:(0,i.jsx)("img",{src:O.imageUrl,alt:"".concat(O.type," view"),className:"w-full h-full object-cover"})}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium text-gray-700",children:"Quality Metrics:"}),(0,i.jsxs)("div",{className:"space-y-1 text-gray-600",children:[(0,i.jsxs)("div",{children:["Overall Quality: ",O.metadata.quality,"%"]}),(0,i.jsxs)("div",{children:["Lighting: ",O.metadata.lighting,"%"]}),(0,i.jsxs)("div",{children:["Positioning: ",O.metadata.positioning,"%"]}),(0,i.jsxs)("div",{children:["Blur: ",O.metadata.blur,"%"]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium text-gray-700",children:"Analysis:"}),(0,i.jsxs)("div",{className:"space-y-1 text-gray-600",children:[(0,i.jsxs)("div",{children:["Body Detected: ",O.analysis.bodyDetected?"Yes":"No"]}),(0,i.jsxs)("div",{children:["Face Detected: ",O.analysis.faceDetected?"Yes":"No"]}),(0,i.jsxs)("div",{children:["Pose Quality: ",O.analysis.poseQuality,"%"]})]})]})]}),O.analysis.recommendations.length>0&&(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium text-gray-700 mb-2",children:"Recommendations:"}),(0,i.jsx)("ul",{className:"space-y-1",children:O.analysis.recommendations.map((e,t)=>(0,i.jsxs)("li",{className:"text-sm text-gray-600 flex items-center gap-2",children:[(0,i.jsx)(u.Z,{className:"h-3 w-3 text-green-500"}),e]},t))})]})]})]})})})]}):(0,i.jsxs)("div",{className:"text-center p-8 ".concat(t),children:[(0,i.jsx)(o.Z,{className:"h-16 w-16 text-blue-500 mx-auto mb-4"}),(0,i.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Automated Progress Photo Capture"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:"Get guided through consistent progress photos with AI voice instructions"}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)(a.zx,{onClick:er,size:"lg",className:"flex items-center gap-2",children:[(0,i.jsx)(o.Z,{className:"h-5 w-5"}),"Start Photo Session"]}),(0,i.jsxs)(a.zx,{onClick:ei,variant:"outline",size:"lg",className:"flex items-center gap-2",disabled:j,children:[(0,i.jsx)(o.Z,{className:"h-5 w-5"}),j?"Camera Active":"Test Camera Only"]})]})]})}},2058:function(e,t,s){s.r(t),s.d(t,{UserProfileService:function(){return i},userProfileService:function(){return r}});class i{createProfile(e){let t={...e,id:this.generateId(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return this.profiles.push(t),this.currentUser=t,this.saveToStorage(),t}getCurrentProfile(){return this.currentUser}updateProfile(e){if(!this.currentUser)return null;this.currentUser={...this.currentUser,...e,updatedAt:new Date().toISOString()};let t=this.profiles.findIndex(e=>e.id===this.currentUser.id);return -1!==t&&(this.profiles[t]=this.currentUser),this.saveToStorage(),this.currentUser}addProgressPhoto(e){let t={...e,id:this.generateId(),createdAt:new Date().toISOString()};return this.progressPhotos.push(t),this.saveToStorage(),t}getProgressPhotos(e){var t;let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e||(null===(t=this.currentUser)||void 0===t?void 0:t.id);return i?this.progressPhotos.filter(e=>e.userId===i).filter(e=>s||!e.isPrivate).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()):[]}getProgressPhotosByDateRange(e,t,s){let i=this.getProgressPhotos(s,!0);return i.filter(s=>s.date>=e&&s.date<=t)}deleteProgressPhoto(e){let t=this.progressPhotos.findIndex(t=>t.id===e);return -1!==t&&(this.progressPhotos.splice(t,1),this.saveToStorage(),!0)}updateProgressPhoto(e,t){let s=this.progressPhotos.findIndex(t=>t.id===e);return -1===s?null:(this.progressPhotos[s]={...this.progressPhotos[s],...t},this.saveToStorage(),this.progressPhotos[s])}calculateBMI(){if(!this.currentUser)return null;let e=this.currentUser.height.centimeters/100,t=this.currentUser.weight.kilograms;return t/(e*e)}getBMICategory(){let e=this.calculateBMI();return e?e<18.5?"underweight":e<25?"normal":e<30?"overweight":"obese":null}calculateBMR(){if(!this.currentUser)return null;let{weight:e,height:t,gender:s,dateOfBirth:i}=this.currentUser;if(!i)return null;let r=this.calculateAge(i),a=e.kilograms,o=t.centimeters;return"male"===s?10*a+6.25*o-5*r+5:"female"===s?10*a+6.25*o-5*r-161:(10*a+6.25*o-5*r+5+(10*a+6.25*o-5*r-161))/2}calculateTDEE(){let e=this.calculateBMR();if(!e||!this.currentUser)return null;let t={sedentary:1.2,lightly_active:1.375,moderately_active:1.55,very_active:1.725,extremely_active:1.9}[this.currentUser.activityLevel];return e*t}calculateAge(e){let t=new Date,s=new Date(e),i=t.getFullYear()-s.getFullYear(),r=t.getMonth()-s.getMonth();return(r<0||0===r&&t.getDate()<s.getDate())&&i--,i}static feetInchesToCm(e,t){return(12*e+t)*2.54}static cmToFeetInches(e){let t=e/2.54;return{feet:Math.floor(t/12),inches:Math.round(t%12)}}static poundsToKg(e){return .453592*e}static kgToPounds(e){return 2.20462*e}getUserStats(){return{totalWorkouts:45,totalWorkoutTime:2700,currentStreak:7,longestStreak:21,totalWeightLost:15.5,totalWeightGained:0,averageWorkoutDuration:36,favoriteExercises:["Push-ups","Squats","Planks","Lunges"],achievements:["First Workout","7-Day Streak","Weight Loss Goal"],level:5,experiencePoints:1250}}canViewProfile(e){var t;let s=this.profiles.find(t=>t.id===e);return!!s&&(e===(null===(t=this.currentUser)||void 0===t?void 0:t.id)||"public"===s.privacySettings.profileVisibility)}canViewProgressPhotos(e){var t;let s=this.profiles.find(t=>t.id===e);return!!s&&(e===(null===(t=this.currentUser)||void 0===t?void 0:t.id)||"public"===s.privacySettings.progressPhotos)}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}saveToStorage(){localStorage.setItem("mobii_user_profiles",JSON.stringify(this.profiles)),localStorage.setItem("mobii_progress_photos",JSON.stringify(this.progressPhotos)),localStorage.setItem("mobii_current_user",JSON.stringify(this.currentUser))}loadFromStorage(){{let e=localStorage.getItem("mobii_user_profiles"),t=localStorage.getItem("mobii_progress_photos"),s=localStorage.getItem("mobii_current_user");e&&(this.profiles=JSON.parse(e)),t&&(this.progressPhotos=JSON.parse(t)),s&&(this.currentUser=JSON.parse(s))}}clearAllData(){this.profiles=[],this.progressPhotos=[],this.currentUser=null,this.saveToStorage()}addSampleData(){this.createProfile({email:"john.doe@example.com",firstName:"John",lastName:"Doe",displayName:"JohnDoe",dateOfBirth:"1990-05-15",gender:"male",height:{feet:5,inches:10,centimeters:178},weight:{pounds:180,kilograms:81.6},fitnessLevel:"intermediate",fitnessGoals:["Lose Weight","Build Muscle","Improve Endurance"],activityLevel:"moderately_active",timezone:"America/New_York",language:"en",units:"imperial",privacySettings:{profileVisibility:"public",progressPhotos:"private",weightData:"private",workoutHistory:"friends",achievements:"public"},preferences:{workoutDuration:45,workoutFrequency:4,preferredWorkoutTime:"evening",musicPreference:"Motivational",voiceCoachStyle:"motivational",notifications:{workoutReminders:!0,progressUpdates:!0,achievements:!0,weeklyReports:!0}}});let e=new Date,t=[];for(let s=29;s>=0;s-=7){let i=new Date(e);i.setDate(i.getDate()-s);let r=180-(29-s)*.5;t.push({userId:this.currentUser.id,date:i.toISOString().split("T")[0],type:"front",imageUrl:"https://via.placeholder.com/400x600/4F46E5/FFFFFF?text=Progress+Photo+".concat(i.toLocaleDateString()),thumbnailUrl:"https://via.placeholder.com/200x300/4F46E5/FFFFFF?text=Thumbnail",weight:Math.round(10*r)/10,bodyFat:Math.round((25-(29-s)*.2)*10)/10,muscleMass:Math.round((150-(29-s)*.1)*10)/10,notes:"Week ".concat(Math.floor((29-s)/7)+1," progress photo"),isPrivate:!0,tags:["front","weekly","progress"]}),t.push({userId:this.currentUser.id,date:i.toISOString().split("T")[0],type:"side",imageUrl:"https://via.placeholder.com/400x600/10B981/FFFFFF?text=Side+View+".concat(i.toLocaleDateString()),thumbnailUrl:"https://via.placeholder.com/200x300/10B981/FFFFFF?text=Side",weight:Math.round(10*r)/10,bodyFat:Math.round((25-(29-s)*.2)*10)/10,muscleMass:Math.round((150-(29-s)*.1)*10)/10,notes:"Week ".concat(Math.floor((29-s)/7)+1," side view"),isPrivate:!0,tags:["side","weekly","progress"]})}t.forEach(e=>this.addProgressPhoto(e))}constructor(){this.profiles=[],this.progressPhotos=[],this.currentUser=null,this.loadFromStorage()}}let r=new i}}]);