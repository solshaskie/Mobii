"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[296],{1296:function(e,t,s){s.d(t,{y:function(){return j}});var a=s(7573),i=s(7653),l=s(4001),n=s(638),r=s(1143),o=s(5240),c=s(4186),d=s(3747),u=s(9690),h=s(5592),m=s(8626),x=s(9854),p=s(7618);class g{getInitialized(){return this.isInitialized}async initialize(){try{return console.log("Initializing MediaPipe Pose..."),this.pose=new m.Pose({locateFile:e=>"https://cdn.jsdelivr.net/npm/@mediapipe/pose/".concat(e)}),this.pose.setOptions({modelComplexity:1,smoothLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),this.pose.onResults(e=>{this.onPoseResults(e)}),this.isInitialized=!0,console.log("MediaPipe Pose initialized successfully"),!0}catch(e){return console.error("Failed to initialize MediaPipe Pose:",e),!1}}onPoseResults(e){if(!e.poseLandmarks)return;let t=e.poseLandmarks;this.poseHistory.push(t),this.poseHistory.length>30&&this.poseHistory.shift();let s=this.analyzeForm(t);this.emitResults(e,s)}analyzeForm(e){let t={posture:"good",feedback:"",confidence:0,repDetected:!1,repCount:this.repCount},s=e.filter(e=>e.visibility&&e.visibility>.5);t.confidence=s.length/e.length;let a=this.analyzePosture(e);a>.8?(t.posture="good",t.feedback="Excellent posture! Keep it up!"):a>.6?(t.posture="needs_improvement",t.feedback="Try to straighten your back and align your shoulders."):(t.posture="poor",t.feedback="Please correct your posture. Stand tall with shoulders back.");let i=this.detectRepetition(e);return i&&(this.repCount++,t.repDetected=!0,t.repCount=this.repCount),t}analyzePosture(e){if(e.length<33)return 0;let t=e[0],s=e[11],a=e[12],i=e[23],l=e[24],n=0,r=0;if(s&&a){let e=Math.abs(s.y-a.y);n+=Math.max(0,1-10*e),r++}if(s&&a&&i&&l){let e=(s.y+a.y)/2,t=(i.y+l.y)/2;n+=Math.max(0,1-5*Math.abs(e-t)),r++}if(t&&s&&a){let e=(s.y+a.y)/2,i=Math.abs(t.y-e);n+=Math.max(0,1-3*i),r++}return r>0?n/r:0}detectRepetition(e){if(this.poseHistory.length<10)return!1;let t=e[15],s=e[16],a=e[13],i=e[14];if(!t||!s||!a||!i)return!1;let l=this.calculateAngle(t,a,e[11]),n=this.calculateAngle(s,i,e[12]),r="".concat(l>90?"up":"down","_").concat(n>90?"up":"down");if(this.lastPoseState&&this.lastPoseState!==r){let e=Date.now()-(this.lastRepTime||0);if(e>1e3)return this.lastRepTime=Date.now(),this.lastPoseState=r,!0}return this.lastPoseState=r,!1}calculateAngle(e,t,s){let a=Math.atan2(s.y-t.y,s.x-t.x)-Math.atan2(e.y-t.y,e.x-t.x);return Math.abs(180*a/Math.PI)}emitResults(e,t){this.onResultsCallback&&this.onResultsCallback(e,t)}setOnResults(e){this.onResultsCallback=e}async startDetection(e,t){if(!this.pose||!this.isInitialized){let e=await this.initialize();if(!e)return!1}try{return console.log("Starting pose detection..."),this.camera=new x.Camera(e,{onFrame:async()=>{this.pose&&await this.pose.send({image:e})},width:640,height:480}),await this.camera.start(),console.log("Pose detection started successfully"),!0}catch(e){return console.error("Failed to start pose detection:",e),!1}}stopDetection(){this.camera&&(this.camera.stop(),this.camera=null),this.repCount=0,this.poseHistory=[],this.lastPoseState="",console.log("Pose detection stopped")}resetRepCount(){this.repCount=0}getRepCount(){return this.repCount}async sendImage(e){this.pose&&this.isInitialized&&await this.pose.send({image:e})}drawPoseLandmarks(e,t){let s=e.getContext("2d");s&&(s.clearRect(0,0,e.width,e.height),t.poseLandmarks&&((0,p.drawConnectors)(s,t.poseLandmarks,m.POSE_CONNECTIONS,{color:"#00FF00",lineWidth:2}),(0,p.drawLandmarks)(s,t.poseLandmarks,{color:"#FF0000",lineWidth:1,radius:3})))}constructor(){this.pose=null,this.camera=null,this.isInitialized=!1,this.repCount=0,this.lastPoseState="",this.lastRepTime=0,this.poseHistory=[],this.onResultsCallback=null}}let y=new g;var f=s(1981);function j(e){let{exerciseName:t,instructions:s,onFormFeedback:m,onRepCount:x,onComplete:p,className:g=""}=e,[j,v]=(0,i.useState)(!1),[b,N]=(0,i.useState)(!1),[w,C]=(0,i.useState)(0),[k,P]=(0,i.useState)(""),[R,S]=(0,i.useState)(!1),[M,z]=(0,i.useState)(!1),[F,I]=(0,i.useState)(0),[A,O]=(0,i.useState)("good"),[E,D]=(0,i.useState)(!0),[V,Z]=(0,i.useState)("motivational"),[L,_]=(0,i.useState)(!1),H=(0,i.useRef)(null),T=(0,i.useRef)(null),Y=(0,i.useRef)(null),U=new f.x;(0,i.useRef)(null);let W=async()=>{try{console.log("Starting camera request...");let e=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"}});if(console.log("Camera stream obtained: ".concat(e.id)),console.log("Stream tracks: ".concat(e.getTracks().map(e=>e.kind).join(", "))),H.current){console.log("Setting video srcObject..."),H.current.srcObject=e,Y.current=e,console.log("Setting isCameraOn to true..."),v(!0),N(!0);try{console.log("Attempting to play video..."),await H.current.play(),console.log("Video play() successful")}catch(e){console.error("Video play() failed:",e)}H.current.onloadedmetadata=()=>{var e,t;console.log("Video loaded, starting pose detection"),console.log("Video dimensions:",null===(e=H.current)||void 0===e?void 0:e.videoWidth,"x",null===(t=H.current)||void 0===t?void 0:t.videoHeight),K(),setTimeout(()=>{Q()},2e3)},H.current.oncanplay=()=>{console.log("Video can play")},H.current.onerror=e=>{console.error("Video error:",e)},H.current.onplay=()=>{console.log("Video play event fired")},H.current.onplaying=()=>{console.log("Video playing event fired")}}else console.error("ERROR: videoRef.current is null")}catch(e){console.error("Failed to start camera:",e),P("Camera access denied. Please enable camera permissions.")}},G=()=>{y.stopDetection(),Y.current&&(Y.current.getTracks().forEach(e=>e.stop()),Y.current=null),H.current&&(H.current.srcObject=null),v(!1),N(!1),I(0),O("good")},K=async()=>{if(H.current&&T.current)try{console.log("Initializing MediaPipe pose detection..."),y.setOnResults((e,t)=>{I(t.confidence),O(t.posture),t.feedback&&(P(t.feedback),null==m||m(t.feedback),E&&!L&&q(t.feedback)),t.repDetected&&(C(t.repCount),null==x||x(t.repCount),E&&!L&&B(t.repCount)),y.drawPoseLandmarks(T.current,e)});let e=await y.startDetection(H.current,T.current);e?console.log("MediaPipe pose detection started successfully"):(console.error("Failed to start pose detection"),P("Failed to initialize AI pose detection. Using fallback mode."))}catch(e){console.error("Error starting pose detection:",e),P("Error initializing AI pose detection. Using fallback mode.")}},q=async e=>{if(E&&!L){_(!0);try{let s=await U.generateFormFeedback(t,e,V);s&&await J(s)}catch(e){console.error("Failed to generate voice feedback:",e)}finally{_(!1)}}},B=async e=>{if(E&&!L){_(!0);try{"Great! That's ".concat(e," ").concat(1===e?"repetition":"repetitions",". Keep going!");let t=await U.generateMotivationalMessage("encouragement",V);t&&await J(t)}catch(e){console.error("Failed to generate rep count voice:",e)}finally{_(!1)}}},J=async e=>new Promise((t,s)=>{let a=new Audio(e);a.onended=()=>t(),a.onerror=()=>s(Error("Audio playback failed")),a.play().catch(s)}),Q=async()=>{if(E){_(!0);try{let e=await U.generateMotivationalMessage("start",V);e&&await J(e)}catch(e){console.error("Failed to start voice coaching:",e)}finally{_(!1)}}};return(0,i.useEffect)(()=>()=>{G()},[]),(0,a.jsxs)("div",{className:"space-y-4 ".concat(g),children:[(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(n.Z,{className:"h-5 w-5 text-teal-400"}),"AI Form Analysis"]})}),(0,a.jsxs)(l.aY,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,a.jsxs)(l.zx,{onClick:()=>{j?G():W()},variant:j?"destructive":"default",className:"flex items-center gap-2",children:[j?(0,a.jsx)(r.Z,{className:"h-4 w-4"}):(0,a.jsx)(n.Z,{className:"h-4 w-4"}),j?"Stop Camera":"Start Camera"]}),(0,a.jsxs)(l.zx,{onClick:()=>{z(!M)},variant:"outline",className:"flex items-center gap-2",children:[M?(0,a.jsx)(o.Z,{className:"h-4 w-4"}):(0,a.jsx)(c.Z,{className:"h-4 w-4"}),M?"Pause":"Play"]}),(0,a.jsxs)(l.zx,{onClick:()=>{S(!R)},variant:"outline",className:"flex items-center gap-2",children:[R?(0,a.jsx)(d.Z,{className:"h-4 w-4"}):(0,a.jsx)(u.Z,{className:"h-4 w-4"}),R?"Unmute":"Mute"]}),(0,a.jsxs)(l.zx,{onClick:()=>{C(0),y.resetRepCount(),null==x||x(0)},variant:"outline",className:"flex items-center gap-2",children:[(0,a.jsx)(h.Z,{className:"h-4 w-4"}),"Reset Reps"]}),(0,a.jsxs)(l.zx,{onClick:()=>D(!E),variant:E?"default":"outline",className:"flex items-center gap-2",children:[E?(0,a.jsx)(u.Z,{className:"h-4 w-4"}):(0,a.jsx)(d.Z,{className:"h-4 w-4"}),E?"Voice On":"Voice Off"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(j?"bg-green-500":"bg-red-500")}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:j?"Camera Active - AI Analysis Running":"Camera Inactive"})]}),j&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"AI Confidence:"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.Ex,{value:100*F,className:"w-20"}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:[Math.round(100*F),"%"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Posture:"}),(0,a.jsx)("div",{className:"px-2 py-1 rounded text-xs ".concat("good"===A?"bg-green-100 text-green-800":"needs_improvement"===A?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:"good"===A?"Good":"needs_improvement"===A?"Needs Work":"Poor"})]})]}),j&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Voice Coach:"}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("select",{value:V,onChange:e=>Z(e.target.value),className:"text-xs border rounded px-2 py-1 bg-white",disabled:!E,children:[(0,a.jsx)("option",{value:"motivational",children:"Motivational"}),(0,a.jsx)("option",{value:"calm",children:"Calm"}),(0,a.jsx)("option",{value:"professional",children:"Professional"}),(0,a.jsx)("option",{value:"friendly",children:"Friendly"}),(0,a.jsx)("option",{value:"energetic",children:"Energetic"})]})})]}),L&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-blue-600",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse"}),"Voice coaching..."]})]})]})]}),(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)(l.ll,{children:"Live Camera Feed"})}),(0,a.jsxs)(l.aY,{children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("video",{ref:H,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full rounded-lg border",style:{maxHeight:"400px",minHeight:"300px"},onLoadedMetadata:()=>console.log("Video metadata loaded"),onCanPlay:()=>console.log("Video can play"),onError:e=>console.error("Video error:",e)}),(0,a.jsx)("canvas",{ref:T,className:"absolute top-0 left-0 w-full h-full pointer-events-none",style:{maxHeight:"400px"}}),b&&(0,a.jsx)("div",{className:"absolute top-4 left-4 bg-black bg-opacity-50 text-white px-3 py-1 rounded text-sm",children:"AI Pose Detection Active"}),!j&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCF9"}),(0,a.jsx)("div",{className:"text-gray-600",children:'Click "Start Camera" to begin'})]})})]}),(0,a.jsxs)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,a.jsx)("strong",{children:"Camera Status:"})," ",j?"Active":"Inactive"]}),(0,a.jsx)("div",{className:"text-xs text-blue-600 mt-1",children:j?"Camera is active and analyzing your form":'Click "Start Camera" to enable AI form analysis'})]})]})]}),(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)(l.ll,{children:"Repetition Counter"})}),(0,a.jsx)(l.aY,{children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-4xl font-bold text-teal-600 mb-2",children:w}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Repetitions Completed"})]})})]}),k&&(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)(l.ll,{children:"AI Form Feedback"})}),(0,a.jsx)(l.aY,{children:(0,a.jsxs)("div",{className:"border rounded-lg p-4 ".concat("good"===A?"bg-green-50 border-green-200":"needs_improvement"===A?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"),children:[(0,a.jsx)("p",{className:"".concat("good"===A?"text-green-800":"needs_improvement"===A?"text-yellow-800":"text-red-800"),children:k}),F>0&&(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-600",children:["AI Confidence: ",Math.round(100*F),"%"]})]})})]}),(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)(l.ll,{children:"Exercise Instructions"})}),(0,a.jsx)(l.aY,{children:(0,a.jsx)("ol",{className:"space-y-2",children:s.map((e,t)=>(0,a.jsxs)("li",{className:"text-gray-700 text-sm flex items-start gap-2",children:[(0,a.jsxs)("span",{className:"text-teal-400 font-bold",children:[t+1,"."]}),(0,a.jsx)("span",{children:e})]},t))})})]}),(0,a.jsx)(l.zx,{onClick:p,className:"w-full py-3 text-lg",disabled:!j,children:"Complete Exercise"})]})}}}]);