"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[221],{5592:function(e,t,r){r.d(t,{Z:function(){return i}});var s=r(4788);let i=(0,s.Z)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]])},206:function(e,t,r){r.d(t,{Z:function(){return i}});var s=r(4788);let i=(0,s.Z)("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]])},5453:function(e,t,r){r.d(t,{Z:function(){return i}});var s=r(4788);let i=(0,s.Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},9690:function(e,t,r){r.d(t,{Z:function(){return i}});var s=r(4788);let i=(0,s.Z)("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]])},3747:function(e,t,r){r.d(t,{Z:function(){return i}});var s=r(4788);let i=(0,s.Z)("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]])},7342:function(e,t,r){r.d(t,{Z:function(){return i}});var s=r(4788);let i=(0,s.Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},5221:function(e,t,r){r.r(t),r.d(t,{AutomatedPhotoCapture:function(){return b}});var s=r(7573),i=r(7653),n=r(4001),o=r(638),a=r(9690),l=r(3747),c=r(7342),u=r(206),d=r(5453),h=r(4788);let p=(0,h.Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var g=r(5592);let m=(0,h.Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);var f=r(5021),y=r(7277);class x{initializeCaptureSteps(){this.captureSteps=[{type:"front",name:"Front View",description:"Stand facing the camera with good posture",instructions:["Stand 6-8 feet from the camera","Face the camera directly","Keep your arms slightly away from your body","Stand with feet shoulder-width apart","Look straight ahead","Maintain natural posture"],positioningGuide:{distance:7,height:80,width:60,posture:["Stand straight with shoulders back","Keep your head level","Arms slightly away from body","Feet shoulder-width apart"],clothing:["Wear form-fitting but comfortable clothing","Avoid baggy clothes that hide body shape","Consider wearing the same outfit for consistency"],lighting:["Ensure even lighting from the front","Avoid harsh shadows","Natural light is preferred"],background:["Use a plain, neutral background","Avoid cluttered or busy backgrounds","Ensure good contrast with your clothing"]},isCompleted:!1},{type:"side",name:"Side View",description:"Turn 90 degrees to show your profile",instructions:["Turn 90 degrees to your right","Keep your head facing forward","Maintain the same posture as front view","Arms slightly away from body","Stand naturally"],positioningGuide:{distance:7,height:80,width:60,posture:["Turn 90 degrees to the right","Keep head facing forward","Maintain straight posture","Arms slightly away from body"],clothing:["Same clothing as front view","Ensure clothing shows body shape clearly"],lighting:["Ensure even lighting from the side","Avoid harsh shadows on face and body"],background:["Same background as front view","Ensure good contrast"]},isCompleted:!1},{type:"back",name:"Back View",description:"Turn to show your back view",instructions:["Turn 180 degrees from front view","Face away from the camera","Keep your head level","Maintain good posture","Arms slightly away from body"],positioningGuide:{distance:7,height:80,width:60,posture:["Turn 180 degrees from front position","Face away from camera","Keep head level and straight","Maintain straight posture","Arms slightly away from body"],clothing:["Same clothing as previous views","Ensure back is clearly visible"],lighting:["Ensure even lighting on back","Avoid shadows that hide definition"],background:["Same background as previous views","Good contrast with clothing"]},isCompleted:!1},{type:"full_body",name:"Full Body View",description:"Step back to show your full body",instructions:["Step back 2-3 feet further","Ensure your entire body is visible","Maintain the same posture","Keep your head level","Arms slightly away from body"],positioningGuide:{distance:10,height:90,width:70,posture:["Stand 10 feet from camera","Ensure full body is in frame","Maintain straight posture","Head level, arms slightly away"],clothing:["Same clothing as all previous views","Ensure full body is clearly visible"],lighting:["Ensure even lighting on entire body","Avoid shadows that hide body shape"],background:["Same background as previous views","Ensure full body stands out clearly"]},isCompleted:!1}]}startCaptureSession(e){let t={id:this.generateId(),userId:e,date:new Date().toISOString().split("T")[0],status:"preparing",currentStep:this.captureSteps[0],photos:[],instructions:[],startTime:new Date().toISOString()};return this.currentSession=t,this.isCapturing=!0,this.addVoiceInstruction({id:this.generateId(),text:"Welcome to your progress photo session! I'll guide you through each position to ensure consistent, high-quality photos.",priority:"high",timing:"immediate"}),this.addVoiceInstruction({id:this.generateId(),text:"Let's start with the front view. Please stand 6-8 feet from the camera and face me directly.",priority:"high",timing:"immediate"}),t}getCurrentSession(){return this.currentSession}addVoiceInstruction(e){this.voiceQueue.push(e),this.speakInstruction(e)}speakInstruction(e){if("speechSynthesis"in window){let t=new SpeechSynthesisUtterance(e.text);t.rate=.9,t.pitch=1,t.volume=1;let r=speechSynthesis.getVoices(),s=r.find(e=>e.lang.includes("en")&&e.name.includes("Google"))||r.find(e=>e.lang.includes("en"));s&&(t.voice=s),speechSynthesis.speak(t)}}analyzePositioning(e){let t={isInPosition:Math.random()>.3,quality:Math.floor(40*Math.random())+60,recommendations:["Move slightly to the left","Stand a bit closer to the camera","Straighten your posture"].slice(0,Math.floor(3*Math.random())+1)};return t}async capturePhoto(e){if(!this.currentSession||!this.isCapturing)return null;try{let t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw Error("Could not get canvas context");t.width=e.videoWidth,t.height=e.videoHeight,r.drawImage(e,0,0,t.width,t.height);let s=await new Promise(e=>{t.toBlob(t=>{t&&e(t)},"image/jpeg",.9)}),i=URL.createObjectURL(s),n=await this.createThumbnail(s),o=this.analyzeCapturedPhoto(s),a={id:this.generateId(),type:this.currentSession.currentStep.type,imageUrl:i,thumbnailUrl:n,metadata:{timestamp:new Date().toISOString(),quality:o.quality,lighting:Math.floor(30*Math.random())+70,positioning:Math.floor(30*Math.random())+70,blur:Math.floor(20*Math.random())+10},analysis:{bodyDetected:o.bodyDetected,faceDetected:o.faceDetected,poseQuality:o.poseQuality,recommendations:o.recommendations}};return this.currentSession.photos.push(a),this.currentSession.currentStep.photoId=a.id,this.currentSession.currentStep.isCompleted=!0,this.addVoiceInstruction({id:this.generateId(),text:"Great! ".concat(this.currentSession.currentStep.name," captured successfully."),priority:"medium",timing:"after_capture"}),a}catch(e){return console.error("Error capturing photo:",e),this.addVoiceInstruction({id:this.generateId(),text:"There was an issue capturing the photo. Let's try again.",priority:"high",timing:"immediate",action:"retake"}),null}}async createThumbnail(e){return new Promise(t=>{let r=document.createElement("canvas"),s=r.getContext("2d"),i=new Image;i.onload=()=>{if(!s){t(URL.createObjectURL(e));return}let n=Math.min(200/i.width,200/i.height);r.width=i.width*n,r.height=i.height*n,s.drawImage(i,0,0,r.width,r.height),r.toBlob(r=>{r?t(URL.createObjectURL(r)):t(URL.createObjectURL(e))},"image/jpeg",.8)},i.src=URL.createObjectURL(e)})}analyzeCapturedPhoto(e){return{bodyDetected:Math.random()>.1,faceDetected:Math.random()>.2,poseQuality:Math.floor(40*Math.random())+60,quality:Math.floor(30*Math.random())+70,recommendations:["Good positioning!","Lighting looks great","Posture is excellent"].slice(0,Math.floor(3*Math.random())+1)}}nextStep(){if(!this.currentSession)return null;let e=this.captureSteps.findIndex(e=>e.type===this.currentSession.currentStep.type);if(!(e<this.captureSteps.length-1))return this.completeSession(),null;{let t=this.captureSteps[e+1];return this.currentSession.currentStep=t,this.addVoiceInstruction({id:this.generateId(),text:"Now let's capture the ".concat(t.name.toLowerCase(),". ").concat(t.instructions[0]),priority:"high",timing:"immediate"}),t}}completeSession(){this.currentSession&&(this.currentSession.status="completed",this.currentSession.endTime=new Date().toISOString(),this.isCapturing=!1,this.addVoiceInstruction({id:this.generateId(),text:"Excellent! All progress photos have been captured successfully. Your photos are now saved to your profile.",priority:"high",timing:"immediate"}),this.savePhotosToProfile())}savePhotosToProfile(){this.currentSession&&Promise.resolve().then(r.bind(r,2058)).then(e=>{let{userProfileService:t}=e;this.currentSession.photos.forEach(e=>{let r={userId:this.currentSession.userId,date:this.currentSession.date,type:e.type,imageUrl:e.imageUrl,thumbnailUrl:e.thumbnailUrl,weight:void 0,bodyFat:void 0,muscleMass:void 0,notes:"Automated capture - ".concat(e.type," view"),isPrivate:!0,tags:[e.type,"automated","progress"]};t.addProgressPhoto(r)})})}retakeCurrentStep(){if(!this.currentSession)return;this.currentSession.currentStep.isCompleted=!1,this.currentSession.currentStep.photoId=void 0;let e=this.currentSession.photos[this.currentSession.photos.length-1];e&&e.type===this.currentSession.currentStep.type&&this.currentSession.photos.pop(),this.addVoiceInstruction({id:this.generateId(),text:"Let's retake the ".concat(this.currentSession.currentStep.name.toLowerCase(),". ").concat(this.currentSession.currentStep.instructions[0]),priority:"high",timing:"immediate"})}getPositioningFeedback(e){let t=this.analyzePositioning(e);return t.isInPosition?{isInPosition:!0,feedback:["Perfect position!","Ready to capture"],nextInstruction:"Hold still, capturing in 3... 2... 1..."}:{isInPosition:!1,feedback:t.recommendations,nextInstruction:"Please adjust your position and try again"}}stopSession(){this.currentSession&&(this.currentSession.status="failed",this.currentSession.endTime=new Date().toISOString()),this.isCapturing=!1,this.currentSession=null,"speechSynthesis"in window&&speechSynthesis.cancel()}getSessionProgress(){if(!this.currentSession)return{currentStep:0,totalSteps:this.captureSteps.length,percentage:0,remainingSteps:this.captureSteps.map(e=>e.name)};let e=this.captureSteps.findIndex(e=>e.type===this.currentSession.currentStep.type),t=this.captureSteps.filter(e=>e.isCompleted).length,r=t/this.captureSteps.length*100,s=this.captureSteps.slice(e+1).map(e=>e.name);return{currentStep:e+1,totalSteps:this.captureSteps.length,percentage:Math.round(r),remainingSteps:s}}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}constructor(){this.currentSession=null,this.isCapturing=!1,this.voiceQueue=[],this.captureSteps=[],this.initializeCaptureSteps()}}let v=new x;var S=r(2058);let w=e=>{let{videoElement:t,photoType:r,onPositionUpdate:n,className:o=""}=e,[a,l]=(0,i.useState)(!0),c=(0,i.useRef)(null);return((0,i.useEffect)(()=>{if(a&&c.current&&t){let e=c.current,r=e.getContext("2d");if(r){e.width=t.videoWidth||t.clientWidth,e.height=t.videoHeight||t.clientHeight,r.clearRect(0,0,e.width,e.height),r.strokeStyle="#00ff00",r.lineWidth=3,r.beginPath();let s=e.width/2,i=e.height/2,n=.3*Math.min(e.width,e.height);r.arc(s,i-.8*n,.15*n,0,2*Math.PI),r.moveTo(s,i-.6*n),r.lineTo(s,i+.4*n),r.moveTo(s-.3*n,i-.2*n),r.lineTo(s+.3*n,i-.2*n),r.moveTo(s,i+.4*n),r.lineTo(s-.2*n,i+.8*n),r.moveTo(s,i+.4*n),r.lineTo(s+.2*n,i+.8*n),r.stroke()}}},[a,t]),t)?(0,s.jsxs)("div",{className:"absolute inset-0 pointer-events-none ".concat(o),style:{zIndex:99999,position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:[a&&(0,s.jsx)("canvas",{ref:c,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:99998,pointerEvents:"none"}}),(0,s.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:99999,fontSize:"4rem",fontWeight:"bold",color:"white",textShadow:"0 0 20px white, 0 0 40px white, 0 0 60px white",filter:"drop-shadow(0 0 10px white)"},children:"✕"}),(0,s.jsx)("div",{style:{position:"absolute",top:"10px",left:"10px",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",padding:"8px",borderRadius:"4px",fontSize:"12px",zIndex:99999},children:"Overlay Active"}),(0,s.jsxs)("button",{onClick:()=>l(!a),style:{position:"absolute",top:"10px",right:"10px",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",padding:"8px",borderRadius:"4px",fontSize:"12px",zIndex:99999,border:"none",cursor:"pointer"},children:["Skeleton: ",a?"ON":"OFF"]}),(0,s.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"60%",height:"85%",border:"2px dashed #00ff00",backgroundColor:"rgba(0, 255, 0, 0.1)",borderRadius:"8px",zIndex:99997}})]}):null},b=e=>{let{className:t="",onComplete:r,onCancel:h}=e,[x,b]=(0,i.useState)(null),[k,j]=(0,i.useState)(!1),[P,I]=(0,i.useState)(!1),[N,C]=(0,i.useState)(!0),[M,E]=(0,i.useState)(!1),[U,D]=(0,i.useState)(!1),[R,T]=(0,i.useState)([]),[F,z]=(0,i.useState)([]),[A,L]=(0,i.useState)(!1),[V,O]=(0,i.useState)(null),[Z,W]=(0,i.useState)(null),_=(0,i.useRef)(null),B=(0,i.useRef)(null),G=(0,i.useRef)(null),H=(0,i.useRef)(null),q=(0,i.useRef)(null),Y=(0,i.useRef)(null);(0,i.useEffect)(()=>()=>{B.current&&B.current.getTracks().forEach(e=>e.stop()),G.current&&clearInterval(G.current),H.current&&clearInterval(H.current),Y.current&&clearInterval(Y.current),q.current&&q.current.stop(),v.stopSession()},[]),(0,i.useEffect)(()=>{console.log("Camera effect triggered:",{session:!!x,isCameraActive:k}),x&&!k&&(console.log("Session started, initializing camera..."),$())},[x,k]),(0,i.useEffect)(()=>{x&&N&&(console.log("Starting voice instructions..."),K())},[x,N]);let K=()=>{H.current&&clearInterval(H.current),v.addVoiceInstruction({id:"initial",text:'Welcome to your progress photo session. You should see a HUGE WHITE X MARK in the center of your screen. Stand directly on top of this X mark, about 6 to 8 feet from the camera. Say "ready" when you\'re positioned on the X.',priority:"high",timing:"immediate"});let e={id:"step",text:"For the ".concat(null==x?void 0:x.currentStep.name,", ").concat(null==x?void 0:x.currentStep.description,". ").concat(null==x?void 0:x.currentStep.instructions.join(". "),'. Look for the HUGE WHITE X MARK in the center of your screen and stand directly on top of it. When you\'re ready, say "ready" or "okay".'),priority:"high",timing:"immediate"};v.addVoiceInstruction(e),Q(),H.current=setInterval(()=>{x&&N&&!M&&v.addVoiceInstruction({id:"encouragement",text:"You're doing great! Look for the green target area with the X mark in the center of your screen. Stand in the center of that area and say \"ready\" when you're positioned correctly.",priority:"medium",timing:"immediate"})},15e3)},Q=()=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){console.log("Speech recognition not supported");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;q.current=new e,q.current.continuous=!0,q.current.interimResults=!1,q.current.lang="en-US",q.current.onstart=()=>{console.log("Voice recognition started"),E(!0)},q.current.onresult=e=>{let t=e.results[e.results.length-1][0].transcript.toLowerCase();console.log("Heard:",t),t.includes("ready")||t.includes("okay")||t.includes("ok")?J():t.includes("capture")||t.includes("take photo")?et():(t.includes("stop")||t.includes("cancel"))&&er()},q.current.onerror=e=>{console.error("Speech recognition error:",e.error),E(!1)},q.current.onend=()=>{console.log("Voice recognition ended"),E(!1),setTimeout(()=>{x&&N&&Q()},1e3)};try{q.current.start()}catch(e){console.error("Error starting voice recognition:",e)}},J=()=>{if(U)X();else if("speechSynthesis"in window){let e=new SpeechSynthesisUtterance(R.length>0?R[0]:"I can see you're not quite in the right position yet. Please adjust your position and try again.");speechSynthesis.speak(e)}},X=()=>{if(W(3),"speechSynthesis"in window){let e=new SpeechSynthesisUtterance("Perfect! Starting countdown in 3, 2, 1...");speechSynthesis.speak(e)}Y.current=setInterval(()=>{W(e=>null===e||e<=1?(clearInterval(Y.current),et(),null):e-1)},1e3)},$=async()=>{try{if(console.log("Starting camera..."),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw Error("getUserMedia is not supported in this browser");let e=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"}});console.log("Camera stream obtained:",e),console.log("Video tracks:",e.getVideoTracks());let t=0;for(;!_.current&&t<10;)console.log("Waiting for video ref... attempt ".concat(t+1)),await new Promise(e=>setTimeout(e,100)),t++;if(_.current){console.log("Video ref found, setting stream..."),_.current.srcObject=e,B.current=e,j(!0),_.current.onloadedmetadata=()=>{var e,t;console.log("Video metadata loaded"),console.log("Video dimensions:",null===(e=_.current)||void 0===e?void 0:e.videoWidth,"x",null===(t=_.current)||void 0===t?void 0:t.videoHeight)},_.current.onplay=()=>{console.log("Video started playing")},_.current.onerror=e=>{console.error("Video error:",e)};try{await _.current.play(),console.log("Video play() successful")}catch(e){console.error("Error playing video:",e)}}else throw console.error("Video ref is still null after waiting"),Error("Video element not available")}catch(e){console.error("Error accessing camera:",e),alert("Unable to access camera: ".concat(e.message,". Please check permissions."))}},ee=async()=>{console.log("Start session button clicked");let e=S.userProfileService.getCurrentProfile();if(!e){console.log("No user profile found, creating sample profile");let e={id:"test-user-1",firstName:"Test",lastName:"User",displayName:"Test User",email:"test@example.com",height:{feet:5,inches:9,centimeters:175},weight:{pounds:154,kilograms:70},fitnessLevel:"beginner",fitnessGoals:["weight loss","strength"],activityLevel:"moderately_active",timezone:"America/New_York",language:"en",units:"imperial",privacySettings:{profileVisibility:"private",progressPhotos:"private",weightData:"private",workoutHistory:"private",achievements:"private"},preferences:{workoutDuration:30,workoutFrequency:3,preferredWorkoutTime:"evening",voiceCoachStyle:"motivational",notifications:{workoutReminders:!0,progressUpdates:!0,achievements:!0,weeklyReports:!0}},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};S.userProfileService.updateProfile(e)}console.log("Starting capture session...");let t=v.startCaptureSession((null==e?void 0:e.id)||"test-user-1");console.log("Session created:",t),b(t)},et=async()=>{if(_.current&&x){I(!0);try{let e=await v.capturePhoto(_.current);e&&(z(t=>[...t,e]),O(e),L(!0))}catch(e){console.error("Error capturing photo:",e)}finally{I(!1)}}},er=()=>{v.stopSession(),B.current&&B.current.getTracks().forEach(e=>e.stop()),G.current&&clearInterval(G.current),H.current&&clearInterval(H.current),Y.current&&clearInterval(Y.current),q.current&&q.current.stop(),W(null),E(!1),h&&h()},es=v.getSessionProgress();return x?(0,s.jsxs)("div",{className:"space-y-6 ".concat(t),children:[(0,s.jsxs)(n.Zb,{children:[(0,s.jsx)(n.Ol,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(n.ll,{className:"flex items-center gap-2",children:[(0,s.jsx)(o.Z,{className:"h-5 w-5 text-blue-500"}),"Progress Photo Session"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(n.zx,{variant:"outline",size:"sm",onClick:()=>{let e=!N;C(e),"speechSynthesis"in window&&N&&speechSynthesis.cancel(),e&&x?K():H.current&&clearInterval(H.current)},className:"flex items-center gap-2",children:[N?(0,s.jsx)(a.Z,{className:"h-4 w-4"}):(0,s.jsx)(l.Z,{className:"h-4 w-4"}),N?"Voice On":"Voice Off"]}),(0,s.jsxs)(n.zx,{variant:"outline",size:"sm",onClick:er,className:"flex items-center gap-2 text-red-600",children:[(0,s.jsx)(c.Z,{className:"h-4 w-4"}),"Stop Session"]})]})]})}),(0,s.jsx)(n.aY,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[(0,s.jsxs)("span",{children:["Step ",es.currentStep," of ",es.totalSteps]}),(0,s.jsxs)("span",{children:[es.percentage,"% Complete"]})]}),(0,s.jsx)(n.Ex,{value:es.percentage,className:"h-2"})]}),(0,s.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,s.jsx)("h3",{className:"font-semibold text-blue-800 mb-2",children:x.currentStep.name}),(0,s.jsx)("p",{className:"text-blue-700 text-sm mb-3",children:x.currentStep.description}),(0,s.jsx)("div",{className:"space-y-1",children:x.currentStep.instructions.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[(0,s.jsx)(u.Z,{className:"h-3 w-3"}),e]},t))})]}),es.remainingSteps.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"Remaining Steps:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:es.remainingSteps.map((e,t)=>(0,s.jsx)(n.Ct,{variant:"outline",className:"text-xs",children:e},t))})]})]})})]}),(0,s.jsxs)(n.Zb,{children:[(0,s.jsx)(n.Ol,{children:(0,s.jsxs)(n.ll,{className:"flex items-center gap-2",children:[(0,s.jsx)(d.Z,{className:"h-5 w-5 text-green-500"}),"Camera Feed"]})}),(0,s.jsx)(n.aY,{children:(0,s.jsx)("div",{className:"relative",children:(0,s.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden",children:[(0,s.jsx)("video",{ref:_,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-96 object-cover"}),(0,s.jsxs)("div",{className:"absolute top-2 left-2 bg-black bg-opacity-70 text-white px-2 py-1 rounded text-xs z-10",children:["Camera: ",k?"Active":"Inactive"]}),(0,s.jsxs)("div",{className:"absolute top-2 right-2 bg-black bg-opacity-70 text-white px-2 py-1 rounded text-xs z-10",children:["Voice: ",M?"\uD83C\uDFA4 Listening":"\uD83D\uDD07 Idle"]}),null!==Z&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center z-20",children:(0,s.jsx)("div",{className:"bg-black bg-opacity-80 text-white text-8xl font-bold rounded-full w-32 h-32 flex items-center justify-center",children:Z})}),(0,s.jsx)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex items-center gap-2 z-10",children:(0,s.jsxs)(n.zx,{onClick:et,disabled:P||!U,className:"flex items-center gap-2",children:[(0,s.jsx)(o.Z,{className:"h-4 w-4"}),P?"Capturing...":"Capture Photo"]})}),x&&(0,s.jsx)(w,{videoElement:_.current,photoType:x.currentStep.type,onPositionUpdate:(e,t)=>{D(e),T(t)}})]})})})]}),F.length>0&&(0,s.jsxs)(n.Zb,{children:[(0,s.jsx)(n.Ol,{children:(0,s.jsxs)(n.ll,{className:"flex items-center gap-2",children:[(0,s.jsx)(p,{className:"h-5 w-5 text-green-500"}),"Captured Photos (",F.length,"/",es.totalSteps,")"]})}),(0,s.jsxs)(n.aY,{children:[(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:F.map(e=>(0,s.jsxs)(f.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"relative group cursor-pointer",onClick:()=>{O(e),L(!0)},children:[(0,s.jsxs)("div",{className:"aspect-[3/4] rounded-lg overflow-hidden bg-gray-100",children:[(0,s.jsx)("img",{src:e.thumbnailUrl,alt:"".concat(e.type," view"),className:"w-full h-full object-cover"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center",children:(0,s.jsx)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:(0,s.jsx)(p,{className:"h-6 w-6 text-white"})})})]}),(0,s.jsxs)("div",{className:"mt-2 text-center",children:[(0,s.jsx)("div",{className:"text-sm font-medium capitalize",children:e.type}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["Quality: ",e.metadata.quality,"%"]})]})]},e.id))}),(0,s.jsxs)("div",{className:"flex justify-center gap-4 mt-6",children:[(0,s.jsxs)(n.zx,{variant:"outline",onClick:()=>{v.retakeCurrentStep(),b(v.getCurrentSession()),z(e=>e.slice(0,-1))},className:"flex items-center gap-2",children:[(0,s.jsx)(g.Z,{className:"h-4 w-4"}),"Retake Current"]}),(0,s.jsxs)(n.zx,{onClick:()=>{let e=v.nextStep();if(e)b(v.getCurrentSession());else{let e=v.getCurrentSession();e&&r&&r(e.photos)}},disabled:!x.currentStep.isCompleted,className:"flex items-center gap-2",children:[es.currentStep===es.totalSteps?"Complete Session":"Next Step",(0,s.jsx)(m,{className:"h-4 w-4"})]})]})]})]}),(0,s.jsx)(y.M,{children:A&&V&&(0,s.jsx)(f.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>L(!1),children:(0,s.jsxs)(f.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h3",{className:"text-lg font-bold",children:[V.type.charAt(0).toUpperCase()+V.type.slice(1)," View"]}),(0,s.jsx)(n.zx,{variant:"ghost",size:"sm",onClick:()=>L(!1),children:(0,s.jsx)(c.Z,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"aspect-[3/4] rounded-lg overflow-hidden bg-gray-100",children:(0,s.jsx)("img",{src:V.imageUrl,alt:"".concat(V.type," view"),className:"w-full h-full object-cover"})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-gray-700",children:"Quality Metrics:"}),(0,s.jsxs)("div",{className:"space-y-1 text-gray-600",children:[(0,s.jsxs)("div",{children:["Overall Quality: ",V.metadata.quality,"%"]}),(0,s.jsxs)("div",{children:["Lighting: ",V.metadata.lighting,"%"]}),(0,s.jsxs)("div",{children:["Positioning: ",V.metadata.positioning,"%"]}),(0,s.jsxs)("div",{children:["Blur: ",V.metadata.blur,"%"]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-gray-700",children:"Analysis:"}),(0,s.jsxs)("div",{className:"space-y-1 text-gray-600",children:[(0,s.jsxs)("div",{children:["Body Detected: ",V.analysis.bodyDetected?"Yes":"No"]}),(0,s.jsxs)("div",{children:["Face Detected: ",V.analysis.faceDetected?"Yes":"No"]}),(0,s.jsxs)("div",{children:["Pose Quality: ",V.analysis.poseQuality,"%"]})]})]})]}),V.analysis.recommendations.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-gray-700 mb-2",children:"Recommendations:"}),(0,s.jsx)("ul",{className:"space-y-1",children:V.analysis.recommendations.map((e,t)=>(0,s.jsxs)("li",{className:"text-sm text-gray-600 flex items-center gap-2",children:[(0,s.jsx)(p,{className:"h-3 w-3 text-green-500"}),e]},t))})]})]})]})})})]}):(0,s.jsxs)("div",{className:"text-center p-8 ".concat(t),children:[(0,s.jsx)(o.Z,{className:"h-16 w-16 text-blue-500 mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Automated Progress Photo Capture"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"Get guided through consistent progress photos with AI voice instructions"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)(n.zx,{onClick:ee,size:"lg",className:"flex items-center gap-2",children:[(0,s.jsx)(o.Z,{className:"h-5 w-5"}),"Start Photo Session"]}),(0,s.jsxs)(n.zx,{onClick:$,variant:"outline",size:"lg",className:"flex items-center gap-2",disabled:k,children:[(0,s.jsx)(o.Z,{className:"h-5 w-5"}),k?"Camera Active":"Test Camera Only"]})]})]})}},2058:function(e,t,r){r.r(t),r.d(t,{UserProfileService:function(){return s},userProfileService:function(){return i}});class s{createProfile(e){let t={...e,id:this.generateId(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return this.profiles.push(t),this.currentUser=t,this.saveToStorage(),t}getCurrentProfile(){return this.currentUser}updateProfile(e){if(!this.currentUser)return null;this.currentUser={...this.currentUser,...e,updatedAt:new Date().toISOString()};let t=this.profiles.findIndex(e=>e.id===this.currentUser.id);return -1!==t&&(this.profiles[t]=this.currentUser),this.saveToStorage(),this.currentUser}addProgressPhoto(e){let t={...e,id:this.generateId(),createdAt:new Date().toISOString()};return this.progressPhotos.push(t),this.saveToStorage(),t}getProgressPhotos(e){var t;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=e||(null===(t=this.currentUser)||void 0===t?void 0:t.id);return s?this.progressPhotos.filter(e=>e.userId===s).filter(e=>r||!e.isPrivate).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()):[]}getProgressPhotosByDateRange(e,t,r){let s=this.getProgressPhotos(r,!0);return s.filter(r=>r.date>=e&&r.date<=t)}deleteProgressPhoto(e){let t=this.progressPhotos.findIndex(t=>t.id===e);return -1!==t&&(this.progressPhotos.splice(t,1),this.saveToStorage(),!0)}updateProgressPhoto(e,t){let r=this.progressPhotos.findIndex(t=>t.id===e);return -1===r?null:(this.progressPhotos[r]={...this.progressPhotos[r],...t},this.saveToStorage(),this.progressPhotos[r])}calculateBMI(){if(!this.currentUser)return null;let e=this.currentUser.height.centimeters/100,t=this.currentUser.weight.kilograms;return t/(e*e)}getBMICategory(){let e=this.calculateBMI();return e?e<18.5?"underweight":e<25?"normal":e<30?"overweight":"obese":null}calculateBMR(){if(!this.currentUser)return null;let{weight:e,height:t,gender:r,dateOfBirth:s}=this.currentUser;if(!s)return null;let i=this.calculateAge(s),n=e.kilograms,o=t.centimeters;return"male"===r?10*n+6.25*o-5*i+5:"female"===r?10*n+6.25*o-5*i-161:(10*n+6.25*o-5*i+5+(10*n+6.25*o-5*i-161))/2}calculateTDEE(){let e=this.calculateBMR();if(!e||!this.currentUser)return null;let t={sedentary:1.2,lightly_active:1.375,moderately_active:1.55,very_active:1.725,extremely_active:1.9}[this.currentUser.activityLevel];return e*t}calculateAge(e){let t=new Date,r=new Date(e),s=t.getFullYear()-r.getFullYear(),i=t.getMonth()-r.getMonth();return(i<0||0===i&&t.getDate()<r.getDate())&&s--,s}static feetInchesToCm(e,t){return(12*e+t)*2.54}static cmToFeetInches(e){let t=e/2.54;return{feet:Math.floor(t/12),inches:Math.round(t%12)}}static poundsToKg(e){return .453592*e}static kgToPounds(e){return 2.20462*e}getUserStats(){return{totalWorkouts:45,totalWorkoutTime:2700,currentStreak:7,longestStreak:21,totalWeightLost:15.5,totalWeightGained:0,averageWorkoutDuration:36,favoriteExercises:["Push-ups","Squats","Planks","Lunges"],achievements:["First Workout","7-Day Streak","Weight Loss Goal"],level:5,experiencePoints:1250}}canViewProfile(e){var t;let r=this.profiles.find(t=>t.id===e);return!!r&&(e===(null===(t=this.currentUser)||void 0===t?void 0:t.id)||"public"===r.privacySettings.profileVisibility)}canViewProgressPhotos(e){var t;let r=this.profiles.find(t=>t.id===e);return!!r&&(e===(null===(t=this.currentUser)||void 0===t?void 0:t.id)||"public"===r.privacySettings.progressPhotos)}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}saveToStorage(){localStorage.setItem("mobii_user_profiles",JSON.stringify(this.profiles)),localStorage.setItem("mobii_progress_photos",JSON.stringify(this.progressPhotos)),localStorage.setItem("mobii_current_user",JSON.stringify(this.currentUser))}loadFromStorage(){{let e=localStorage.getItem("mobii_user_profiles"),t=localStorage.getItem("mobii_progress_photos"),r=localStorage.getItem("mobii_current_user");e&&(this.profiles=JSON.parse(e)),t&&(this.progressPhotos=JSON.parse(t)),r&&(this.currentUser=JSON.parse(r))}}clearAllData(){this.profiles=[],this.progressPhotos=[],this.currentUser=null,this.saveToStorage()}addSampleData(){this.createProfile({email:"john.doe@example.com",firstName:"John",lastName:"Doe",displayName:"JohnDoe",dateOfBirth:"1990-05-15",gender:"male",height:{feet:5,inches:10,centimeters:178},weight:{pounds:180,kilograms:81.6},fitnessLevel:"intermediate",fitnessGoals:["Lose Weight","Build Muscle","Improve Endurance"],activityLevel:"moderately_active",timezone:"America/New_York",language:"en",units:"imperial",privacySettings:{profileVisibility:"public",progressPhotos:"private",weightData:"private",workoutHistory:"friends",achievements:"public"},preferences:{workoutDuration:45,workoutFrequency:4,preferredWorkoutTime:"evening",musicPreference:"Motivational",voiceCoachStyle:"motivational",notifications:{workoutReminders:!0,progressUpdates:!0,achievements:!0,weeklyReports:!0}}});let e=new Date,t=[];for(let r=29;r>=0;r-=7){let s=new Date(e);s.setDate(s.getDate()-r);let i=180-(29-r)*.5;t.push({userId:this.currentUser.id,date:s.toISOString().split("T")[0],type:"front",imageUrl:"https://via.placeholder.com/400x600/4F46E5/FFFFFF?text=Progress+Photo+".concat(s.toLocaleDateString()),thumbnailUrl:"https://via.placeholder.com/200x300/4F46E5/FFFFFF?text=Thumbnail",weight:Math.round(10*i)/10,bodyFat:Math.round((25-(29-r)*.2)*10)/10,muscleMass:Math.round((150-(29-r)*.1)*10)/10,notes:"Week ".concat(Math.floor((29-r)/7)+1," progress photo"),isPrivate:!0,tags:["front","weekly","progress"]}),t.push({userId:this.currentUser.id,date:s.toISOString().split("T")[0],type:"side",imageUrl:"https://via.placeholder.com/400x600/10B981/FFFFFF?text=Side+View+".concat(s.toLocaleDateString()),thumbnailUrl:"https://via.placeholder.com/200x300/10B981/FFFFFF?text=Side",weight:Math.round(10*i)/10,bodyFat:Math.round((25-(29-r)*.2)*10)/10,muscleMass:Math.round((150-(29-r)*.1)*10)/10,notes:"Week ".concat(Math.floor((29-r)/7)+1," side view"),isPrivate:!0,tags:["side","weekly","progress"]})}t.forEach(e=>this.addProgressPhoto(e))}constructor(){this.profiles=[],this.progressPhotos=[],this.currentUser=null,this.loadFromStorage()}}let i=new s},7277:function(e,t,r){r.d(t,{M:function(){return f}});var s=r(7653),i=r(323);function n(){let e=(0,s.useRef)(!1);return(0,i.L)(()=>(e.current=!0,()=>{e.current=!1}),[]),e}var o=r(6564),a=r(693),l=r(8787);class c extends s.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function u({children:e,isPresent:t}){let r=(0,s.useId)(),i=(0,s.useRef)(null),n=(0,s.useRef)({width:0,height:0,top:0,left:0});return(0,s.useInsertionEffect)(()=>{let{width:e,height:s,top:o,left:a}=n.current;if(t||!i.current||!e||!s)return;i.current.dataset.motionPopId=r;let l=document.createElement("style");return document.head.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${s}px !important;
            top: ${o}px !important;
            left: ${a}px !important;
          }
        `),()=>{document.head.removeChild(l)}},[t]),s.createElement(c,{isPresent:t,childRef:i,sizeRef:n},s.cloneElement(e,{ref:i}))}let d=({children:e,initial:t,isPresent:r,onExitComplete:i,custom:n,presenceAffectsLayout:o,mode:c})=>{let d=(0,l.h)(h),p=(0,s.useId)(),g=(0,s.useMemo)(()=>({id:p,initial:t,isPresent:r,custom:n,onExitComplete:e=>{for(let t of(d.set(e,!0),d.values()))if(!t)return;i&&i()},register:e=>(d.set(e,!1),()=>d.delete(e))}),o?void 0:[r]);return(0,s.useMemo)(()=>{d.forEach((e,t)=>d.set(t,!1))},[r]),s.useEffect(()=>{r||d.size||!i||i()},[r]),"popLayout"===c&&(e=s.createElement(u,{isPresent:r},e)),s.createElement(a.O.Provider,{value:g},e)};function h(){return new Map}var p=r(4258),g=r(8256);let m=e=>e.key||"",f=({children:e,custom:t,initial:r=!0,onExitComplete:a,exitBeforeEnter:l,presenceAffectsLayout:c=!0,mode:u="sync"})=>{var h;(0,g.k)(!l,"Replace exitBeforeEnter with mode='wait'");let f=(0,s.useContext)(p.p).forceRender||function(){let e=n(),[t,r]=(0,s.useState)(0),i=(0,s.useCallback)(()=>{e.current&&r(t+1)},[t]),a=(0,s.useCallback)(()=>o.Wi.postRender(i),[i]);return[a,t]}()[0],y=n(),x=function(e){let t=[];return s.Children.forEach(e,e=>{(0,s.isValidElement)(e)&&t.push(e)}),t}(e),v=x,S=(0,s.useRef)(new Map).current,w=(0,s.useRef)(v),b=(0,s.useRef)(new Map).current,k=(0,s.useRef)(!0);if((0,i.L)(()=>{k.current=!1,function(e,t){e.forEach(e=>{let r=m(e);t.set(r,e)})}(x,b),w.current=v}),h=()=>{k.current=!0,b.clear(),S.clear()},(0,s.useEffect)(()=>()=>h(),[]),k.current)return s.createElement(s.Fragment,null,v.map(e=>s.createElement(d,{key:m(e),isPresent:!0,initial:!!r&&void 0,presenceAffectsLayout:c,mode:u},e)));v=[...v];let j=w.current.map(m),P=x.map(m),I=j.length;for(let e=0;e<I;e++){let t=j[e];-1!==P.indexOf(t)||S.has(t)||S.set(t,void 0)}return"wait"===u&&S.size&&(v=[]),S.forEach((e,r)=>{if(-1!==P.indexOf(r))return;let i=b.get(r);if(!i)return;let n=j.indexOf(r),o=e;o||(o=s.createElement(d,{key:m(i),isPresent:!1,onExitComplete:()=>{S.delete(r);let e=Array.from(b.keys()).filter(e=>!P.includes(e));if(e.forEach(e=>b.delete(e)),w.current=x.filter(t=>{let s=m(t);return s===r||e.includes(s)}),!S.size){if(!1===y.current)return;f(),a&&a()}},custom:t,presenceAffectsLayout:c,mode:u},i),S.set(r,o)),v.splice(n,0,o)}),v=v.map(e=>{let t=e.key;return S.has(t)?e:s.createElement(d,{key:m(e),isPresent:!0,presenceAffectsLayout:c,mode:u},e)}),s.createElement(s.Fragment,null,S.size?v:v.map(e=>(0,s.cloneElement)(e)))}}}]);